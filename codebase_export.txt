================================================================================
HYPD GAMES - FULL CODEBASE EXPORT
================================================================================
A mobile-first instant gaming website with TikTok-style vertical scroll feed
Tech Stack: React + FastAPI + MongoDB
================================================================================



========== BACKEND ==========


--- /app/backend/server.py ---

from fastapi import FastAPI, APIRouter, HTTPException, Depends, UploadFile, File, Form, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from fastapi.responses import StreamingResponse
from dotenv import load_dotenv
from starlette.middleware.cors import CORSMiddleware
from motor.motor_asyncio import AsyncIOMotorClient, AsyncIOMotorGridFSBucket
from bson import ObjectId
import os
import logging
from pathlib import Path
from pydantic import BaseModel, Field, EmailStr
from typing import List, Optional
import uuid
from datetime import datetime, timezone, timedelta
import jwt
import bcrypt
import io
import base64
import zipfile
from PIL import Image

ROOT_DIR = Path(__file__).parent
load_dotenv(ROOT_DIR / '.env')

# MongoDB connection
mongo_url = os.environ['MONGO_URL']
client = AsyncIOMotorClient(mongo_url)
db = client[os.environ['DB_NAME']]
fs = AsyncIOMotorGridFSBucket(db)

# JWT Configuration
JWT_SECRET = os.environ.get('JWT_SECRET', 'hypd-games-secret-key-2024')
JWT_ALGORITHM = "HS256"
JWT_EXPIRATION_HOURS = 24

# Security
security = HTTPBearer()

# Image compression helper
def compress_image(image_data: bytes, max_size: int = 800, quality: int = 75) -> str:
    """Compress and resize image, return as base64 data URL"""
    try:
        img = Image.open(io.BytesIO(image_data))
        
        # Convert to RGB if necessary (for PNG with transparency)
        if img.mode in ('RGBA', 'P'):
            img = img.convert('RGB')
        
        # Resize if too large
        if max(img.size) > max_size:
            ratio = max_size / max(img.size)
            new_size = (int(img.size[0] * ratio), int(img.size[1] * ratio))
            img = img.resize(new_size, Image.Resampling.LANCZOS)
        
        # Save as JPEG with compression
        buffer = io.BytesIO()
        img.save(buffer, format='JPEG', quality=quality, optimize=True)
        compressed_data = buffer.getvalue()
        
        return f"data:image/jpeg;base64,{base64.b64encode(compressed_data).decode()}"
    except Exception as e:
        logging.error(f"Image compression error: {e}")
        # Fallback to original if compression fails
        return f"data:image/jpeg;base64,{base64.b64encode(image_data).decode()}"

# Create the main app
app = FastAPI(title="Hypd Games API")

# Create a router with the /api prefix
api_router = APIRouter(prefix="/api")

# ==================== MODELS ====================

class UserCreate(BaseModel):
    username: str
    email: EmailStr
    password: str

class UserLogin(BaseModel):
    email: EmailStr
    password: str

class UserResponse(BaseModel):
    id: str
    username: str
    email: str
    is_admin: bool = False
    created_at: str
    saved_games: List[str] = []
    high_scores: dict = {}

class TokenResponse(BaseModel):
    access_token: str
    token_type: str = "bearer"
    user: UserResponse

class GameCreate(BaseModel):
    title: str
    description: str
    category: str
    thumbnail_url: Optional[str] = None
    video_url: Optional[str] = None
    is_visible: bool = True

class GameResponse(BaseModel):
    id: str
    title: str
    description: str
    category: str
    thumbnail_url: Optional[str] = None
    video_url: Optional[str] = None
    is_visible: bool
    play_count: int = 0
    created_at: str
    has_game_file: bool = False

class GameUpdate(BaseModel):
    title: Optional[str] = None
    description: Optional[str] = None
    category: Optional[str] = None
    thumbnail_url: Optional[str] = None
    video_url: Optional[str] = None
    is_visible: Optional[bool] = None

class HighScoreUpdate(BaseModel):
    game_id: str
    score: int

class SettingsResponse(BaseModel):
    logo_url: Optional[str] = None

class PlaySessionCreate(BaseModel):
    game_id: str
    duration_seconds: int = 0
    score: Optional[int] = None

class GameAnalytics(BaseModel):
    game_id: str
    title: str
    total_plays: int
    unique_players: int
    avg_duration: float
    total_play_time: int
    plays_today: int
    plays_this_week: int

class OverallAnalytics(BaseModel):
    total_games: int
    total_plays: int
    total_users: int
    active_users_today: int
    top_games: List[dict]
    plays_by_category: dict
    plays_by_day: List[dict]

# ==================== AUTH HELPERS ====================

def hash_password(password: str) -> str:
    return bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt()).decode('utf-8')

def verify_password(password: str, hashed: str) -> bool:
    return bcrypt.checkpw(password.encode('utf-8'), hashed.encode('utf-8'))

def create_token(user_id: str) -> str:
    payload = {
        "sub": user_id,
        "exp": datetime.now(timezone.utc) + timedelta(hours=JWT_EXPIRATION_HOURS),
        "iat": datetime.now(timezone.utc)
    }
    return jwt.encode(payload, JWT_SECRET, algorithm=JWT_ALGORITHM)

async def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security)):
    try:
        payload = jwt.decode(credentials.credentials, JWT_SECRET, algorithms=[JWT_ALGORITHM])
        user_id = payload.get("sub")
        if not user_id:
            raise HTTPException(status_code=401, detail="Invalid token")
        
        user = await db.users.find_one({"id": user_id}, {"_id": 0, "password": 0})
        if not user:
            raise HTTPException(status_code=401, detail="User not found")
        return user
    except jwt.ExpiredSignatureError:
        raise HTTPException(status_code=401, detail="Token expired")
    except jwt.InvalidTokenError:
        raise HTTPException(status_code=401, detail="Invalid token")

async def get_admin_user(user: dict = Depends(get_current_user)):
    if not user.get("is_admin"):
        raise HTTPException(status_code=403, detail="Admin access required")
    return user

# ==================== AUTH ROUTES ====================

@api_router.post("/auth/register", response_model=TokenResponse)
async def register(data: UserCreate):
    # Check if email exists
    existing = await db.users.find_one({"email": data.email})
    if existing:
        raise HTTPException(status_code=400, detail="Email already registered")
    
    # Check if username exists
    existing_username = await db.users.find_one({"username": data.username})
    if existing_username:
        raise HTTPException(status_code=400, detail="Username already taken")
    
    user_id = str(uuid.uuid4())
    user_doc = {
        "id": user_id,
        "username": data.username,
        "email": data.email,
        "password": hash_password(data.password),
        "is_admin": False,
        "created_at": datetime.now(timezone.utc).isoformat(),
        "saved_games": [],
        "high_scores": {}
    }
    
    await db.users.insert_one(user_doc)
    
    token = create_token(user_id)
    user_response = UserResponse(
        id=user_id,
        username=data.username,
        email=data.email,
        is_admin=False,
        created_at=user_doc["created_at"],
        saved_games=[],
        high_scores={}
    )
    
    return TokenResponse(access_token=token, user=user_response)

@api_router.post("/auth/login", response_model=TokenResponse)
async def login(data: UserLogin):
    user = await db.users.find_one({"email": data.email})
    if not user or not verify_password(data.password, user["password"]):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    
    token = create_token(user["id"])
    user_response = UserResponse(
        id=user["id"],
        username=user["username"],
        email=user["email"],
        is_admin=user.get("is_admin", False),
        created_at=user["created_at"],
        saved_games=user.get("saved_games", []),
        high_scores=user.get("high_scores", {})
    )
    
    return TokenResponse(access_token=token, user=user_response)

@api_router.get("/auth/me", response_model=UserResponse)
async def get_me(user: dict = Depends(get_current_user)):
    return UserResponse(**user)

@api_router.post("/auth/save-game/{game_id}")
async def save_game(game_id: str, user: dict = Depends(get_current_user)):
    await db.users.update_one(
        {"id": user["id"]},
        {"$addToSet": {"saved_games": game_id}}
    )
    return {"message": "Game saved"}

@api_router.delete("/auth/save-game/{game_id}")
async def unsave_game(game_id: str, user: dict = Depends(get_current_user)):
    await db.users.update_one(
        {"id": user["id"]},
        {"$pull": {"saved_games": game_id}}
    )
    return {"message": "Game removed from saved"}

@api_router.post("/auth/high-score")
async def update_high_score(data: HighScoreUpdate, user: dict = Depends(get_current_user)):
    current_scores = user.get("high_scores", {})
    current_best = current_scores.get(data.game_id, 0)
    
    if data.score > current_best:
        await db.users.update_one(
            {"id": user["id"]},
            {"$set": {f"high_scores.{data.game_id}": data.score}}
        )
        return {"message": "New high score!", "score": data.score}
    return {"message": "Score recorded", "score": current_best}

# ==================== GAME ROUTES ====================

@api_router.get("/games", response_model=List[GameResponse])
async def get_games(category: Optional[str] = None, visible_only: bool = True):
    query = {}
    if category and category != "all":
        query["category"] = category
    if visible_only:
        query["is_visible"] = True
    
    games = await db.games.find(query, {"_id": 0}).sort("created_at", -1).to_list(100)
    return [GameResponse(**g) for g in games]

@api_router.get("/games/{game_id}", response_model=GameResponse)
async def get_game(game_id: str):
    game = await db.games.find_one({"id": game_id}, {"_id": 0})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    return GameResponse(**game)

@api_router.get("/games/{game_id}/play")
async def get_game_file(game_id: str):
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    # Increment play count
    await db.games.update_one({"id": game_id}, {"$inc": {"play_count": 1}})
    
    # Get game HTML content from GridFS or embedded
    if game.get("game_file_id"):
        try:
            grid_out = await fs.open_download_stream(ObjectId(game["game_file_id"]))
            content = await grid_out.read()
            
            # Check if content is a ZIP file
            if content[:2] == b'PK':
                try:
                    with zipfile.ZipFile(io.BytesIO(content)) as zf:
                        # Look for index.html or main HTML file
                        html_files = [f for f in zf.namelist() if f.endswith('.html') and not f.startswith('__MACOSX')]
                        
                        if not html_files:
                            raise HTTPException(status_code=404, detail="No HTML file found in ZIP")
                        
                        # Prefer index.html, otherwise use first HTML file
                        html_file = None
                        for f in html_files:
                            if f.endswith('index.html'):
                                html_file = f
                                break
                        if not html_file:
                            html_file = html_files[0]
                        
                        # Get the base path for assets
                        base_path = '/'.join(html_file.split('/')[:-1])
                        if base_path:
                            base_path += '/'
                        
                        html_content = zf.read(html_file).decode('utf-8', errors='ignore')
                        
                        # Inject base tag and inline critical assets
                        base_tag = f'<base href="/api/games/{game_id}/assets/{base_path}">'
                        if '<head>' in html_content:
                            html_content = html_content.replace('<head>', f'<head>\n{base_tag}', 1)
                        elif '<HEAD>' in html_content:
                            html_content = html_content.replace('<HEAD>', f'<HEAD>\n{base_tag}', 1)
                        else:
                            html_content = base_tag + html_content
                        
                        return StreamingResponse(
                            io.BytesIO(html_content.encode()),
                            media_type="text/html",
                            headers={"Content-Disposition": f"inline; filename={game['title']}.html"}
                        )
                except zipfile.BadZipFile:
                    logging.error(f"Invalid ZIP file for game {game_id}")
            else:
                # Regular HTML file
                return StreamingResponse(
                    io.BytesIO(content),
                    media_type="text/html",
                    headers={"Content-Disposition": f"inline; filename={game['title']}.html"}
                )
        except Exception as e:
            logging.error(f"Error reading game file: {e}")
    
    # Return embedded game content if available
    if game.get("game_content"):
        return StreamingResponse(
            io.BytesIO(game["game_content"].encode()),
            media_type="text/html"
        )
    
    raise HTTPException(status_code=404, detail="Game file not found")

@api_router.get("/games/{game_id}/assets/{path:path}")
async def get_game_asset(game_id: str, path: str):
    """Serve assets from ZIP game files"""
    game = await db.games.find_one({"id": game_id})
    if not game or not game.get("game_file_id"):
        raise HTTPException(status_code=404, detail="Game not found")
    
    try:
        grid_out = await fs.open_download_stream(ObjectId(game["game_file_id"]))
        content = await grid_out.read()
        
        if content[:2] != b'PK':
            raise HTTPException(status_code=404, detail="Game is not a ZIP file")
        
        with zipfile.ZipFile(io.BytesIO(content)) as zf:
            # Try to find the file in the ZIP
            try:
                asset_content = zf.read(path)
            except KeyError:
                raise HTTPException(status_code=404, detail=f"Asset not found: {path}")
            
            # Determine content type
            content_type = "application/octet-stream"
            if path.endswith('.js'):
                content_type = "application/javascript"
            elif path.endswith('.css'):
                content_type = "text/css"
            elif path.endswith('.html'):
                content_type = "text/html"
            elif path.endswith('.json'):
                content_type = "application/json"
            elif path.endswith('.png'):
                content_type = "image/png"
            elif path.endswith('.jpg') or path.endswith('.jpeg'):
                content_type = "image/jpeg"
            elif path.endswith('.gif'):
                content_type = "image/gif"
            elif path.endswith('.svg'):
                content_type = "image/svg+xml"
            elif path.endswith('.webp'):
                content_type = "image/webp"
            elif path.endswith('.mp3'):
                content_type = "audio/mpeg"
            elif path.endswith('.wav'):
                content_type = "audio/wav"
            elif path.endswith('.ogg'):
                content_type = "audio/ogg"
            elif path.endswith('.woff') or path.endswith('.woff2'):
                content_type = "font/woff2"
            
            return StreamingResponse(
                io.BytesIO(asset_content),
                media_type=content_type
            )
    except Exception as e:
        logging.error(f"Error reading game asset: {e}")
        raise HTTPException(status_code=500, detail="Error reading game asset")

@api_router.get("/categories")
async def get_categories():
    categories = await db.games.distinct("category")
    return {"categories": categories}

# ==================== ANALYTICS ROUTES ====================

@api_router.post("/analytics/play-session")
async def record_play_session(data: PlaySessionCreate):
    """Record a play session for analytics"""
    session_doc = {
        "id": str(uuid.uuid4()),
        "game_id": data.game_id,
        "duration_seconds": data.duration_seconds,
        "score": data.score,
        "played_at": datetime.now(timezone.utc).isoformat(),
        "date": datetime.now(timezone.utc).strftime("%Y-%m-%d")
    }
    await db.play_sessions.insert_one(session_doc)
    return {"message": "Session recorded"}

@api_router.get("/admin/analytics/overview")
async def get_analytics_overview(user: dict = Depends(get_admin_user)):
    """Get overall platform analytics"""
    now = datetime.now(timezone.utc)
    today = now.strftime("%Y-%m-%d")
    week_ago = (now - timedelta(days=7)).strftime("%Y-%m-%d")
    
    # Total counts
    total_games = await db.games.count_documents({})
    total_users = await db.users.count_documents({})
    total_plays = await db.play_sessions.count_documents({})
    
    # Today's stats
    plays_today = await db.play_sessions.count_documents({"date": today})
    
    # Get unique users who played today
    active_users_pipeline = [
        {"$match": {"date": today}},
        {"$group": {"_id": "$user_id"}},
        {"$count": "count"}
    ]
    active_result = await db.play_sessions.aggregate(active_users_pipeline).to_list(1)
    active_users_today = active_result[0]["count"] if active_result else 0
    
    # Top games by play count
    top_games_pipeline = [
        {"$group": {"_id": "$game_id", "plays": {"$sum": 1}, "total_time": {"$sum": "$duration_seconds"}}},
        {"$sort": {"plays": -1}},
        {"$limit": 5}
    ]
    top_games_raw = await db.play_sessions.aggregate(top_games_pipeline).to_list(5)
    
    # Enrich with game titles
    top_games = []
    for tg in top_games_raw:
        game = await db.games.find_one({"id": tg["_id"]}, {"_id": 0, "title": 1, "category": 1, "thumbnail_url": 1})
        if game:
            top_games.append({
                "game_id": tg["_id"],
                "title": game.get("title", "Unknown"),
                "category": game.get("category", "Unknown"),
                "thumbnail_url": game.get("thumbnail_url"),
                "plays": tg["plays"],
                "total_time_minutes": round(tg["total_time"] / 60, 1)
            })
    
    # If no play sessions yet, use play_count from games
    if not top_games:
        games = await db.games.find({}, {"_id": 0}).sort("play_count", -1).limit(5).to_list(5)
        top_games = [{
            "game_id": g["id"],
            "title": g["title"],
            "category": g["category"],
            "thumbnail_url": g.get("thumbnail_url"),
            "plays": g.get("play_count", 0),
            "total_time_minutes": 0
        } for g in games]
    
    # Plays by category
    category_pipeline = [
        {"$group": {"_id": "$game_id", "plays": {"$sum": 1}}},
    ]
    category_raw = await db.play_sessions.aggregate(category_pipeline).to_list(100)
    
    plays_by_category = {}
    for cr in category_raw:
        game = await db.games.find_one({"id": cr["_id"]}, {"_id": 0, "category": 1})
        if game:
            cat = game.get("category", "Other")
            plays_by_category[cat] = plays_by_category.get(cat, 0) + cr["plays"]
    
    # If no sessions, use game play_count
    if not plays_by_category:
        games = await db.games.find({}, {"_id": 0, "category": 1, "play_count": 1}).to_list(100)
        for g in games:
            cat = g.get("category", "Other")
            plays_by_category[cat] = plays_by_category.get(cat, 0) + g.get("play_count", 0)
    
    # Plays by day (last 7 days)
    plays_by_day = []
    for i in range(6, -1, -1):
        day = (now - timedelta(days=i)).strftime("%Y-%m-%d")
        day_label = (now - timedelta(days=i)).strftime("%a")
        count = await db.play_sessions.count_documents({"date": day})
        plays_by_day.append({"date": day, "day": day_label, "plays": count})
    
    return {
        "total_games": total_games,
        "total_plays": total_plays or sum(g.get("play_count", 0) for g in await db.games.find({}, {"_id": 0, "play_count": 1}).to_list(100)),
        "total_users": total_users,
        "active_users_today": active_users_today,
        "plays_today": plays_today,
        "top_games": top_games,
        "plays_by_category": plays_by_category,
        "plays_by_day": plays_by_day
    }

@api_router.get("/admin/analytics/game/{game_id}")
async def get_game_analytics(game_id: str, user: dict = Depends(get_admin_user)):
    """Get detailed analytics for a specific game"""
    game = await db.games.find_one({"id": game_id}, {"_id": 0})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    now = datetime.now(timezone.utc)
    today = now.strftime("%Y-%m-%d")
    week_ago = (now - timedelta(days=7)).strftime("%Y-%m-%d")
    
    # Session stats
    sessions = await db.play_sessions.find({"game_id": game_id}, {"_id": 0}).to_list(1000)
    
    total_plays = len(sessions)
    total_duration = sum(s.get("duration_seconds", 0) for s in sessions)
    avg_duration = total_duration / total_plays if total_plays > 0 else 0
    
    # Unique players
    unique_players = len(set(s.get("user_id", s.get("id")) for s in sessions))
    
    # Today and week stats
    plays_today = sum(1 for s in sessions if s.get("date") == today)
    plays_this_week = sum(1 for s in sessions if s.get("date", "") >= week_ago)
    
    # Daily breakdown
    daily_plays = []
    for i in range(6, -1, -1):
        day = (now - timedelta(days=i)).strftime("%Y-%m-%d")
        day_label = (now - timedelta(days=i)).strftime("%a")
        count = sum(1 for s in sessions if s.get("date") == day)
        daily_plays.append({"date": day, "day": day_label, "plays": count})
    
    # Score distribution (if scores tracked)
    scores = [s.get("score") for s in sessions if s.get("score") is not None]
    score_stats = {
        "avg_score": round(sum(scores) / len(scores), 1) if scores else 0,
        "high_score": max(scores) if scores else 0,
        "total_scored_sessions": len(scores)
    }
    
    return {
        "game_id": game_id,
        "title": game["title"],
        "category": game["category"],
        "total_plays": total_plays or game.get("play_count", 0),
        "unique_players": unique_players,
        "avg_duration_seconds": round(avg_duration, 1),
        "total_play_time_minutes": round(total_duration / 60, 1),
        "plays_today": plays_today,
        "plays_this_week": plays_this_week,
        "daily_plays": daily_plays,
        "score_stats": score_stats
    }

# ==================== ADMIN ROUTES ====================

@api_router.post("/admin/games", response_model=GameResponse)
async def create_game(data: GameCreate, user: dict = Depends(get_admin_user)):
    game_id = str(uuid.uuid4())
    game_doc = {
        "id": game_id,
        "title": data.title,
        "description": data.description,
        "category": data.category,
        "thumbnail_url": data.thumbnail_url,
        "video_url": data.video_url,
        "is_visible": data.is_visible,
        "play_count": 0,
        "created_at": datetime.now(timezone.utc).isoformat(),
        "has_game_file": False
    }
    
    await db.games.insert_one(game_doc)
    return GameResponse(**game_doc)

@api_router.put("/admin/games/{game_id}", response_model=GameResponse)
async def update_game(game_id: str, data: GameUpdate, user: dict = Depends(get_admin_user)):
    update_data = {k: v for k, v in data.model_dump().items() if v is not None}
    if not update_data:
        raise HTTPException(status_code=400, detail="No update data provided")
    
    result = await db.games.update_one({"id": game_id}, {"$set": update_data})
    if result.matched_count == 0:
        raise HTTPException(status_code=404, detail="Game not found")
    
    game = await db.games.find_one({"id": game_id}, {"_id": 0})
    return GameResponse(**game)

@api_router.delete("/admin/games/{game_id}")
async def delete_game(game_id: str, user: dict = Depends(get_admin_user)):
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    # Delete game file from GridFS if exists
    if game.get("game_file_id"):
        try:
            await fs.delete(ObjectId(game["game_file_id"]))
        except:
            pass
    
    await db.games.delete_one({"id": game_id})
    return {"message": "Game deleted"}

@api_router.post("/admin/games/{game_id}/upload")
async def upload_game_file(
    game_id: str,
    file: UploadFile = File(...),
    user: dict = Depends(get_admin_user)
):
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    # Delete old file if exists
    if game.get("game_file_id"):
        try:
            await fs.delete(ObjectId(game["game_file_id"]))
        except:
            pass
    
    # Read and store new file
    content = await file.read()
    file_id = await fs.upload_from_stream(
        f"{game_id}_{file.filename}",
        io.BytesIO(content),
        metadata={"game_id": game_id, "filename": file.filename}
    )
    
    await db.games.update_one(
        {"id": game_id},
        {"$set": {"game_file_id": str(file_id), "has_game_file": True}}
    )
    
    return {"message": "Game file uploaded", "file_id": str(file_id)}

@api_router.post("/admin/games/{game_id}/content")
async def set_game_content(
    game_id: str,
    content: str = Form(...),
    user: dict = Depends(get_admin_user)
):
    """Set embedded HTML content for a game (for sample games)"""
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    await db.games.update_one(
        {"id": game_id},
        {"$set": {"game_content": content, "has_game_file": True}}
    )
    
    return {"message": "Game content set"}

@api_router.get("/admin/games", response_model=List[GameResponse])
async def get_all_games_admin(user: dict = Depends(get_admin_user)):
    games = await db.games.find({}, {"_id": 0}).sort("created_at", -1).to_list(100)
    return [GameResponse(**g) for g in games]

@api_router.post("/admin/toggle-visibility/{game_id}")
async def toggle_game_visibility(game_id: str, user: dict = Depends(get_admin_user)):
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    new_visibility = not game.get("is_visible", True)
    await db.games.update_one({"id": game_id}, {"$set": {"is_visible": new_visibility}})
    
    return {"message": f"Game {'shown' if new_visibility else 'hidden'}", "is_visible": new_visibility}

@api_router.post("/admin/games/create-with-files")
async def create_game_with_files(
    title: str = Form(...),
    description: str = Form(...),
    category: str = Form(...),
    is_visible: bool = Form(True),
    game_file: Optional[UploadFile] = File(None),
    thumbnail_file: Optional[UploadFile] = File(None),
    explore_image_file: Optional[UploadFile] = File(None),
    user: dict = Depends(get_admin_user)
):
    """Create a game with file uploads for game, thumbnail, and explore image"""
    game_id = str(uuid.uuid4())
    
    # Process thumbnail image with compression
    thumbnail_url = None
    if thumbnail_file and thumbnail_file.filename:
        content = await thumbnail_file.read()
        thumbnail_url = compress_image(content, max_size=800, quality=75)
    
    # Process explore image with compression (can be same as thumbnail or different)
    explore_image_url = None
    if explore_image_file and explore_image_file.filename:
        content = await explore_image_file.read()
        explore_image_url = compress_image(content, max_size=400, quality=70)
    else:
        explore_image_url = thumbnail_url  # Default to thumbnail if not provided
    
    game_doc = {
        "id": game_id,
        "title": title,
        "description": description,
        "category": category,
        "thumbnail_url": thumbnail_url,
        "explore_image_url": explore_image_url,
        "video_url": None,
        "is_visible": is_visible,
        "play_count": 0,
        "created_at": datetime.now(timezone.utc).isoformat(),
        "has_game_file": False
    }
    
    # Process game file
    if game_file and game_file.filename:
        content = await game_file.read()
        file_id = await fs.upload_from_stream(
            f"{game_id}_{game_file.filename}",
            io.BytesIO(content),
            metadata={"game_id": game_id, "filename": game_file.filename}
        )
        game_doc["game_file_id"] = str(file_id)
        game_doc["has_game_file"] = True
    
    await db.games.insert_one(game_doc)
    
    return {
        "id": game_id,
        "title": title,
        "description": description,
        "category": category,
        "thumbnail_url": thumbnail_url,
        "explore_image_url": explore_image_url,
        "video_url": None,
        "is_visible": is_visible,
        "play_count": 0,
        "created_at": game_doc["created_at"],
        "has_game_file": game_doc["has_game_file"]
    }

@api_router.put("/admin/games/{game_id}/update-with-files")
async def update_game_with_files(
    game_id: str,
    title: Optional[str] = Form(None),
    description: Optional[str] = Form(None),
    category: Optional[str] = Form(None),
    is_visible: Optional[bool] = Form(None),
    game_file: Optional[UploadFile] = File(None),
    thumbnail_file: Optional[UploadFile] = File(None),
    explore_image_file: Optional[UploadFile] = File(None),
    user: dict = Depends(get_admin_user)
):
    """Update a game with optional file uploads"""
    game = await db.games.find_one({"id": game_id})
    if not game:
        raise HTTPException(status_code=404, detail="Game not found")
    
    update_data = {}
    
    if title is not None:
        update_data["title"] = title
    if description is not None:
        update_data["description"] = description
    if category is not None:
        update_data["category"] = category
    if is_visible is not None:
        update_data["is_visible"] = is_visible
    
    # Process thumbnail image with compression
    if thumbnail_file and thumbnail_file.filename:
        content = await thumbnail_file.read()
        update_data["thumbnail_url"] = compress_image(content, max_size=800, quality=75)
    
    # Process explore image with compression
    if explore_image_file and explore_image_file.filename:
        content = await explore_image_file.read()
        update_data["explore_image_url"] = compress_image(content, max_size=400, quality=70)
    
    # Process game file
    if game_file and game_file.filename:
        # Delete old file if exists
        if game.get("game_file_id"):
            try:
                await fs.delete(ObjectId(game["game_file_id"]))
            except:
                pass
        
        content = await game_file.read()
        file_id = await fs.upload_from_stream(
            f"{game_id}_{game_file.filename}",
            io.BytesIO(content),
            metadata={"game_id": game_id, "filename": game_file.filename}
        )
        update_data["game_file_id"] = str(file_id)
        update_data["has_game_file"] = True
    
    if update_data:
        await db.games.update_one({"id": game_id}, {"$set": update_data})
    
    updated_game = await db.games.find_one({"id": game_id}, {"_id": 0})
    return GameResponse(**updated_game)

# ==================== SETTINGS ROUTES ====================

@api_router.get("/settings", response_model=SettingsResponse)
async def get_settings():
    settings = await db.settings.find_one({"key": "site_settings"}, {"_id": 0})
    if not settings:
        return SettingsResponse()
    return SettingsResponse(logo_url=settings.get("logo_url"))

@api_router.post("/admin/settings/logo")
async def upload_logo(file: UploadFile = File(...), user: dict = Depends(get_admin_user)):
    content = await file.read()
    # Store as base64 for simplicity
    logo_data = f"data:{file.content_type};base64,{base64.b64encode(content).decode()}"
    
    await db.settings.update_one(
        {"key": "site_settings"},
        {"$set": {"logo_url": logo_data}},
        upsert=True
    )
    
    return {"message": "Logo uploaded", "logo_url": logo_data}

# ==================== SEED DATA ====================

@api_router.post("/admin/seed")
async def seed_sample_games(user: dict = Depends(get_admin_user)):
    """Seed sample games for demo"""
    sample_games = [
        {
            "id": str(uuid.uuid4()),
            "title": "Neon Blocks",
            "description": "Classic block stacking puzzle with a neon twist. Stack the falling blocks to clear lines!",
            "category": "Puzzle",
            "thumbnail_url": "https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=800&q=80",
            "is_visible": True,
            "play_count": 0,
            "created_at": datetime.now(timezone.utc).isoformat(),
            "has_game_file": True,
            "game_content": NEON_BLOCKS_GAME
        },
        {
            "id": str(uuid.uuid4()),
            "title": "Space Dodge",
            "description": "Pilot your ship through an asteroid field. How long can you survive?",
            "category": "Action",
            "thumbnail_url": "https://images.unsplash.com/photo-1590034295051-004f272713a4?w=800&q=80",
            "is_visible": True,
            "play_count": 0,
            "created_at": datetime.now(timezone.utc).isoformat(),
            "has_game_file": True,
            "game_content": SPACE_DODGE_GAME
        },
        {
            "id": str(uuid.uuid4()),
            "title": "Color Match",
            "description": "Match colors as fast as you can! Test your reflexes in this addictive tapper.",
            "category": "Arcade",
            "thumbnail_url": "https://images.unsplash.com/photo-1721987203048-24725e93047e?w=800&q=80",
            "is_visible": True,
            "play_count": 0,
            "created_at": datetime.now(timezone.utc).isoformat(),
            "has_game_file": True,
            "game_content": COLOR_MATCH_GAME
        },
        {
            "id": str(uuid.uuid4()),
            "title": "Cyber Runner",
            "description": "Run through the neon city, dodge obstacles and collect power-ups!",
            "category": "Action",
            "thumbnail_url": "https://images.unsplash.com/photo-1684536689765-c4ebf55da2ae?w=800&q=80",
            "is_visible": True,
            "play_count": 0,
            "created_at": datetime.now(timezone.utc).isoformat(),
            "has_game_file": True,
            "game_content": CYBER_RUNNER_GAME
        }
    ]
    
    # Clear existing games
    await db.games.delete_many({})
    
    # Insert sample games
    await db.games.insert_many(sample_games)
    
    return {"message": f"Seeded {len(sample_games)} sample games"}

# ==================== SAMPLE GAME HTML ====================

NEON_BLOCKS_GAME = '''<!DOCTYPE html>
<html><head><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>*{margin:0;padding:0;box-sizing:border-box}body{background:#0a0a0a;display:flex;justify-content:center;align-items:center;min-height:100vh;font-family:system-ui;touch-action:none}
#game{position:relative}canvas{border:2px solid #CCFF00;border-radius:8px}#score{position:absolute;top:-40px;left:0;color:#CCFF00;font-size:20px;font-weight:bold}
#controls{position:absolute;bottom:-80px;left:50%;transform:translateX(-50%);display:flex;gap:15px}
.btn{width:60px;height:60px;background:rgba(204,255,0,0.2);border:2px solid #CCFF00;border-radius:50%;color:#CCFF00;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.btn:active{background:rgba(204,255,0,0.5)}</style></head>
<body><div id="game"><div id="score">Score: 0</div><canvas id="c" width="240" height="400"></canvas>
<div id="controls"><button class="btn" ontouchstart="moveLeft()" onclick="moveLeft()">←</button>
<button class="btn" ontouchstart="rotate()" onclick="rotate()">↻</button>
<button class="btn" ontouchstart="moveRight()" onclick="moveRight()">→</button>
<button class="btn" ontouchstart="drop()" onclick="drop()">↓</button></div></div>
<script>const c=document.getElementById("c").getContext("2d"),W=10,H=20,B=24;let board=Array(H).fill().map(()=>Array(W).fill(0)),score=0,piece,px,py;
const shapes=[[[[1,1,1,1]],[[1],[1],[1],[1]]],[[[1,1],[1,1]]],[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]],[[[1,0,0],[1,1,1]],[[1,1],[1,0],[1,0]],[[1,1,1],[0,0,1]],[[0,1],[0,1],[1,1]]],[[[0,0,1],[1,1,1]],[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0]],[[1,1],[0,1],[0,1]]],[[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]],[[1,1,1],[0,1,0]],[[0,1],[1,1],[0,1]]]];
const colors=["#00FFFF","#FFFF00","#00FF00","#FF0000","#0000FF","#FF7F00","#8B00FF"];let rot=0,si=0;
function newPiece(){si=Math.floor(Math.random()*shapes.length);rot=0;piece=shapes[si][rot];px=Math.floor((W-piece[0].length)/2);py=0;if(collision())gameOver()}
function collision(){for(let y=0;y<piece.length;y++)for(let x=0;x<piece[y].length;x++)if(piece[y][x]&&(board[py+y]===undefined||board[py+y][px+x]===undefined||board[py+y][px+x]))return true;return false}
function merge(){for(let y=0;y<piece.length;y++)for(let x=0;x<piece[y].length;x++)if(piece[y][x])board[py+y][px+x]=si+1}
function clearLines(){let lines=0;for(let y=H-1;y>=0;y--){if(board[y].every(c=>c)){board.splice(y,1);board.unshift(Array(W).fill(0));lines++;y++}}score+=lines*100;document.getElementById("score").textContent="Score: "+score}
function draw(){c.fillStyle="#0a0a0a";c.fillRect(0,0,W*B,H*B);for(let y=0;y<H;y++)for(let x=0;x<W;x++)if(board[y][x]){c.fillStyle=colors[board[y][x]-1];c.fillRect(x*B+1,y*B+1,B-2,B-2)}
for(let y=0;y<piece.length;y++)for(let x=0;x<piece[y].length;x++)if(piece[y][x]){c.fillStyle=colors[si];c.fillRect((px+x)*B+1,(py+y)*B+1,B-2,B-2)}}
function moveLeft(){px--;if(collision())px++}function moveRight(){px++;if(collision())px--}
function rotate(){const oldRot=rot;rot=(rot+1)%shapes[si].length;piece=shapes[si][rot];if(collision()){rot=oldRot;piece=shapes[si][rot]}}
function drop(){py++;if(collision()){py--;merge();clearLines();newPiece()}}
function gameOver(){alert("Game Over! Score: "+score);board=Array(H).fill().map(()=>Array(W).fill(0));score=0;document.getElementById("score").textContent="Score: 0";newPiece()}
function update(){drop();draw();setTimeout(update,500)}
document.addEventListener("keydown",e=>{if(e.key==="ArrowLeft")moveLeft();if(e.key==="ArrowRight")moveRight();if(e.key==="ArrowUp")rotate();if(e.key==="ArrowDown")drop();draw()});
newPiece();draw();setTimeout(update,500);</script></body></html>'''

SPACE_DODGE_GAME = '''<!DOCTYPE html>
<html><head><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>*{margin:0;padding:0;box-sizing:border-box}body{background:#050510;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;touch-action:none}
canvas{border-radius:8px;max-width:100vw;max-height:100vh}</style></head>
<body><canvas id="c"></canvas>
<script>const c=document.getElementById("c"),x=c.getContext("2d");c.width=400;c.height=600;
let ship={x:200,y:500,w:30,h:40},asteroids=[],score=0,gameOver=false,touch={x:200};
function spawnAsteroid(){asteroids.push({x:Math.random()*(c.width-40)+20,y:-40,r:Math.random()*20+15,s:Math.random()*3+2})}
function draw(){x.fillStyle="#050510";x.fillRect(0,0,c.width,c.height);
for(let i=0;i<50;i++){x.fillStyle="rgba(255,255,255,"+(Math.random()*0.5+0.2)+")";x.fillRect(Math.random()*c.width,Math.random()*c.height,1,1)}
x.fillStyle="#CCFF00";x.beginPath();x.moveTo(ship.x,ship.y-ship.h/2);x.lineTo(ship.x-ship.w/2,ship.y+ship.h/2);x.lineTo(ship.x+ship.w/2,ship.y+ship.h/2);x.closePath();x.fill();
x.shadowBlur=20;x.shadowColor="#CCFF00";x.fillStyle="#7000FF";
asteroids.forEach(a=>{x.beginPath();x.arc(a.x,a.y,a.r,0,Math.PI*2);x.fill()});x.shadowBlur=0;
x.fillStyle="#fff";x.font="bold 24px system-ui";x.fillText("Score: "+score,20,40);
if(gameOver){x.fillStyle="rgba(0,0,0,0.8)";x.fillRect(0,0,c.width,c.height);x.fillStyle="#CCFF00";x.font="bold 40px system-ui";x.textAlign="center";x.fillText("GAME OVER",c.width/2,c.height/2-20);x.font="24px system-ui";x.fillText("Score: "+score,c.width/2,c.height/2+20);x.fillText("Tap to restart",c.width/2,c.height/2+60)}}
function update(){if(gameOver)return;ship.x+=(touch.x-ship.x)*0.1;ship.x=Math.max(ship.w/2,Math.min(c.width-ship.w/2,ship.x));
asteroids.forEach(a=>{a.y+=a.s;const dx=ship.x-a.x,dy=ship.y-a.y;if(Math.sqrt(dx*dx+dy*dy)<a.r+15)gameOver=true});
asteroids=asteroids.filter(a=>a.y<c.height+50);if(Math.random()<0.03)spawnAsteroid();score++}
function loop(){update();draw();requestAnimationFrame(loop)}
c.addEventListener("touchmove",e=>{e.preventDefault();touch.x=e.touches[0].clientX-c.getBoundingClientRect().left});
c.addEventListener("mousemove",e=>{touch.x=e.clientX-c.getBoundingClientRect().left});
c.addEventListener("click",()=>{if(gameOver){asteroids=[];score=0;ship.x=200;gameOver=false}});
loop();</script></body></html>'''

COLOR_MATCH_GAME = '''<!DOCTYPE html>
<html><head><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>*{margin:0;padding:0;box-sizing:border-box}body{background:#0a0a0a;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;font-family:system-ui}
#score{color:#CCFF00;font-size:32px;font-weight:bold;margin-bottom:20px}#word{font-size:48px;font-weight:bold;margin-bottom:40px;text-transform:uppercase}
#buttons{display:grid;grid-template-columns:1fr 1fr;gap:15px;width:300px}
.btn{padding:25px;font-size:20px;font-weight:bold;border:none;border-radius:12px;cursor:pointer;text-transform:uppercase;transition:transform 0.1s}
.btn:active{transform:scale(0.95)}#timer{width:300px;height:8px;background:#222;border-radius:4px;margin-top:30px;overflow:hidden}
#bar{height:100%;background:#CCFF00;transition:width 0.1s linear}#msg{color:#fff;font-size:24px;margin-top:20px;min-height:30px}</style></head>
<body><div id="score">Score: 0</div><div id="word">RED</div><div id="buttons">
<button class="btn" style="background:#FF4444" onclick="check('red')">Red</button>
<button class="btn" style="background:#4444FF" onclick="check('blue')">Blue</button>
<button class="btn" style="background:#44FF44;color:#000" onclick="check('green')">Green</button>
<button class="btn" style="background:#FFFF44;color:#000" onclick="check('yellow')">Yellow</button></div>
<div id="timer"><div id="bar" style="width:100%"></div></div><div id="msg"></div>
<script>const colors=["red","blue","green","yellow"],names=["RED","BLUE","GREEN","YELLOW"],css=["#FF4444","#4444FF","#44FF44","#FFFF44"];
let score=0,timeLeft=100,correct,gameOver=false;
function newRound(){const wordIdx=Math.floor(Math.random()*4),colorIdx=Math.floor(Math.random()*4);
document.getElementById("word").textContent=names[wordIdx];document.getElementById("word").style.color=css[colorIdx];correct=colors[colorIdx]}
function check(c){if(gameOver)return;if(c===correct){score+=10;timeLeft=Math.min(100,timeLeft+10);document.getElementById("msg").textContent="✓ Correct!";document.getElementById("msg").style.color="#CCFF00"}
else{score=Math.max(0,score-5);timeLeft-=20;document.getElementById("msg").textContent="✗ Wrong!";document.getElementById("msg").style.color="#FF4444"}
document.getElementById("score").textContent="Score: "+score;if(timeLeft<=0){endGame()}else{newRound()}}
function endGame(){gameOver=true;document.getElementById("word").textContent="GAME OVER";document.getElementById("word").style.color="#fff";
document.getElementById("msg").textContent="Tap any button to restart"}
function tick(){if(gameOver)return;timeLeft-=1;document.getElementById("bar").style.width=timeLeft+"%";if(timeLeft<=0)endGame()}
function restart(){score=0;timeLeft=100;gameOver=false;document.getElementById("score").textContent="Score: 0";newRound()}
document.querySelectorAll(".btn").forEach(b=>b.addEventListener("click",()=>{if(gameOver)restart()}));
newRound();setInterval(tick,100);</script></body></html>'''

CYBER_RUNNER_GAME = '''<!DOCTYPE html>
<html><head><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>*{margin:0;padding:0;box-sizing:border-box}body{background:#050510;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow:hidden;touch-action:none}
canvas{border-radius:8px}</style></head>
<body><canvas id="c"></canvas>
<script>const c=document.getElementById("c"),x=c.getContext("2d");c.width=400;c.height=600;
let player={x:200,y:450,w:40,h:60,vy:0,grounded:true},obstacles=[],coins=[],score=0,speed=5,gameOver=false,jumping=false;
const ground=500,gravity=0.8,jumpForce=-15;
function spawnObstacle(){obstacles.push({x:c.width,y:ground-40,w:30,h:40})}
function spawnCoin(){coins.push({x:c.width,y:ground-100-Math.random()*100,r:15})}
function draw(){x.fillStyle="#050510";x.fillRect(0,0,c.width,c.height);
x.strokeStyle="#7000FF33";for(let i=0;i<20;i++){x.beginPath();x.moveTo(0,i*30+((Date.now()/20)%30));x.lineTo(c.width,i*30+((Date.now()/20)%30));x.stroke()}
for(let i=0;i<10;i++){x.beginPath();x.moveTo(i*40+((Date.now()/10)%40),0);x.lineTo(i*40+((Date.now()/10)%40),c.height);x.stroke()}
x.fillStyle="#7000FF";x.fillRect(0,ground,c.width,100);x.fillStyle="#CCFF00";
x.fillRect(player.x-player.w/2,player.y-player.h,player.w,player.h);x.fillStyle="#050510";
x.fillRect(player.x-10,player.y-player.h+15,8,8);x.fillRect(player.x+2,player.y-player.h+15,8,8);
x.fillStyle="#FF4444";obstacles.forEach(o=>{x.fillRect(o.x,o.y,o.w,o.h)});
x.fillStyle="#CCFF00";x.shadowBlur=15;x.shadowColor="#CCFF00";
coins.forEach(co=>{x.beginPath();x.arc(co.x,co.y,co.r,0,Math.PI*2);x.fill()});x.shadowBlur=0;
x.fillStyle="#fff";x.font="bold 24px system-ui";x.fillText("Score: "+score,20,40);
if(gameOver){x.fillStyle="rgba(0,0,0,0.8)";x.fillRect(0,0,c.width,c.height);x.fillStyle="#CCFF00";x.font="bold 40px system-ui";x.textAlign="center";
x.fillText("GAME OVER",c.width/2,c.height/2-20);x.font="24px system-ui";x.fillText("Score: "+score,c.width/2,c.height/2+20);x.fillText("Tap to restart",c.width/2,c.height/2+60)}}
function update(){if(gameOver)return;player.vy+=gravity;player.y+=player.vy;if(player.y>=ground){player.y=ground;player.vy=0;player.grounded=true}
obstacles.forEach(o=>{o.x-=speed;if(player.x+player.w/2>o.x&&player.x-player.w/2<o.x+o.w&&player.y>o.y&&player.y-player.h<o.y+o.h)gameOver=true});
coins.forEach((co,i)=>{co.x-=speed;const dx=player.x-co.x,dy=(player.y-player.h/2)-co.y;if(Math.sqrt(dx*dx+dy*dy)<co.r+20){coins.splice(i,1);score+=100}});
obstacles=obstacles.filter(o=>o.x>-50);coins=coins.filter(co=>co.x>-20);
if(Math.random()<0.02)spawnObstacle();if(Math.random()<0.03)spawnCoin();score++;speed=5+Math.floor(score/500)*0.5}
function jump(){if(player.grounded&&!gameOver){player.vy=jumpForce;player.grounded=false}}
function loop(){update();draw();requestAnimationFrame(loop)}
c.addEventListener("touchstart",e=>{e.preventDefault();if(gameOver){obstacles=[];coins=[];score=0;speed=5;player.y=ground;gameOver=false}else jump()});
c.addEventListener("click",()=>{if(gameOver){obstacles=[];coins=[];score=0;speed=5;player.y=ground;gameOver=false}else jump()});
document.addEventListener("keydown",e=>{if(e.code==="Space")jump()});
loop();</script></body></html>'''

# Include the router in the main app
app.include_router(api_router)

app.add_middleware(
    CORSMiddleware,
    allow_credentials=True,
    allow_origins=os.environ.get('CORS_ORIGINS', '*').split(','),
    allow_methods=["*"],
    allow_headers=["*"],
)

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

@app.on_event("shutdown")
async def shutdown_db_client():
    client.close()


--- /app/backend/requirements.txt ---

aiofiles==25.1.0
aiohappyeyeballs==2.6.1
aiohttp==3.13.3
aiosignal==1.4.0
annotated-types==0.7.0
anyio==4.12.0
attrs==25.4.0
bcrypt==4.1.3
black==25.12.0
boto3==1.42.21
botocore==1.42.21
certifi==2026.1.4
cffi==2.0.0
charset-normalizer==3.4.4
click==8.3.1
cryptography==46.0.3
distro==1.9.0
dnspython==2.8.0
ecdsa==0.19.1
email-validator==2.3.0
emergentintegrations==0.1.0
fastapi==0.110.1
fastuuid==0.14.0
filelock==3.20.2
flake8==7.3.0
frozenlist==1.8.0
fsspec==2025.12.0
google-ai-generativelanguage==0.6.15
google-api-core==2.29.0
google-api-python-client==2.187.0
google-auth==2.47.0
google-auth-httplib2==0.3.0
google-genai==1.57.0
google-generativeai==0.8.6
googleapis-common-protos==1.72.0
grpcio==1.76.0
grpcio-status==1.71.2
h11==0.16.0
hf-xet==1.2.0
httpcore==1.0.9
httplib2==0.31.0
httpx==0.28.1
huggingface_hub==1.2.4
idna==3.11
importlib_metadata==8.7.1
iniconfig==2.3.0
isort==7.0.0
Jinja2==3.1.6
jiter==0.12.0
jmespath==1.0.1
jq==1.10.0
jsonschema==4.26.0
jsonschema-specifications==2025.9.1
librt==0.7.7
litellm==1.80.0
markdown-it-py==4.0.0
MarkupSafe==3.0.3
mccabe==0.7.0
mdurl==0.1.2
motor==3.3.1
multidict==6.7.0
mypy==1.19.1
mypy_extensions==1.1.0
numpy==2.4.0
oauthlib==3.3.1
openai==1.99.9
packaging==25.0
pandas==2.3.3
passlib==1.7.4
pathspec==0.12.1
pillow==12.1.0
platformdirs==4.5.1
pluggy==1.6.0
propcache==0.4.1
proto-plus==1.27.0
protobuf==5.29.5
pyasn1==0.6.1
pyasn1_modules==0.4.2
pycodestyle==2.14.0
pycparser==2.23
pydantic==2.12.5
pydantic_core==2.41.5
pyflakes==3.4.0
Pygments==2.19.2
PyJWT==2.10.1
pymongo==4.5.0
pyparsing==3.3.1
pytest==9.0.2
python-dateutil==2.9.0.post0
python-dotenv==1.2.1
python-jose==3.5.0
python-multipart==0.0.21
pytokens==0.3.0
pytz==2025.2
PyYAML==6.0.3
referencing==0.37.0
regex==2025.11.3
requests==2.32.5
requests-oauthlib==2.0.0
rich==14.2.0
rpds-py==0.30.0
rsa==4.9.1
s3transfer==0.16.0
s5cmd==0.2.0
shellingham==1.5.4
six==1.17.0
sniffio==1.3.1
starlette==0.37.2
stripe==14.1.0
tenacity==9.1.2
tiktoken==0.12.0
tokenizers==0.22.2
tqdm==4.67.1
typer==0.21.0
typer-slim==0.21.1
typing-inspection==0.4.2
typing_extensions==4.15.0
tzdata==2025.3
uritemplate==4.2.0
urllib3==2.6.2
uvicorn==0.25.0
watchfiles==1.1.1
websockets==15.0.1
yarl==1.22.0
zipp==3.23.0


--- /app/backend/.env (template) ---

MONGO_URL=mongodb://localhost:27017
DB_NAME=hypd_games
JWT_SECRET=your-secret-key-here


========== FRONTEND CONFIG ==========


--- /app/frontend/package.json ---

{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@fontsource/chivo": "^5.2.8",
    "@fontsource/manrope": "^5.2.8",
    "@hookform/resolvers": "^5.0.1",
    "@radix-ui/react-accordion": "^1.2.8",
    "@radix-ui/react-alert-dialog": "^1.1.11",
    "@radix-ui/react-aspect-ratio": "^1.1.4",
    "@radix-ui/react-avatar": "^1.1.7",
    "@radix-ui/react-checkbox": "^1.2.3",
    "@radix-ui/react-collapsible": "^1.1.8",
    "@radix-ui/react-context-menu": "^2.2.12",
    "@radix-ui/react-dialog": "^1.1.11",
    "@radix-ui/react-dropdown-menu": "^2.1.12",
    "@radix-ui/react-hover-card": "^1.1.11",
    "@radix-ui/react-label": "^2.1.4",
    "@radix-ui/react-menubar": "^1.1.12",
    "@radix-ui/react-navigation-menu": "^1.2.10",
    "@radix-ui/react-popover": "^1.1.11",
    "@radix-ui/react-progress": "^1.1.4",
    "@radix-ui/react-radio-group": "^1.3.4",
    "@radix-ui/react-scroll-area": "^1.2.6",
    "@radix-ui/react-select": "^2.2.2",
    "@radix-ui/react-separator": "^1.1.4",
    "@radix-ui/react-slider": "^1.3.2",
    "@radix-ui/react-slot": "^1.2.0",
    "@radix-ui/react-switch": "^1.2.2",
    "@radix-ui/react-tabs": "^1.1.9",
    "@radix-ui/react-toast": "^1.2.11",
    "@radix-ui/react-toggle": "^1.1.6",
    "@radix-ui/react-toggle-group": "^1.1.7",
    "@radix-ui/react-tooltip": "^1.2.4",
    "axios": "^1.8.4",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "cra-template": "1.2.0",
    "date-fns": "^4.1.0",
    "embla-carousel-react": "^8.6.0",
    "framer-motion": "^12.26.2",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.507.0",
    "next-themes": "^0.4.6",
    "react": "^19.0.0",
    "react-day-picker": "8.10.1",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.56.2",
    "react-resizable-panels": "^3.0.1",
    "react-router-dom": "^7.5.1",
    "react-scripts": "5.0.1",
    "recharts": "^3.6.0",
    "sonner": "^2.0.3",
    "tailwind-merge": "^3.2.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^1.1.2",
    "zod": "^3.24.4"
  },
  "scripts": {
    "start": "craco start",
    "build": "craco build",
    "test": "craco test"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "@babel/plugin-proposal-private-property-in-object": "^7.21.11",
    "@craco/craco": "^7.1.0",
    "@eslint/js": "9.23.0",
    "autoprefixer": "^10.4.20",
    "eslint": "9.23.0",
    "eslint-plugin-import": "2.31.0",
    "eslint-plugin-jsx-a11y": "6.10.2",
    "eslint-plugin-react": "7.37.4",
    "eslint-plugin-react-hooks": "5.2.0",
    "globals": "15.15.0",
    "postcss": "^8.4.49",
    "tailwindcss": "^3.4.17"
  },
  "packageManager": "yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e"
}


--- /app/frontend/tailwind.config.js ---

/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{js,jsx}',
    './components/**/*.{js,jsx}',
    './app/**/*.{js,jsx}',
    './src/**/*.{js,jsx}',
  ],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      fontFamily: {
        sans: ['Manrope', 'sans-serif'],
        heading: ['Chivo', 'sans-serif'],
        mono: ['JetBrains Mono', 'monospace'],
      },
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        lime: {
          DEFAULT: "#CCFF00",
          dark: "#b3e600",
        },
        violet: {
          DEFAULT: "#7000FF",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "pulse-glow": {
          "0%, 100%": { boxShadow: "0 0 20px rgba(204, 255, 0, 0.3)" },
          "50%": { boxShadow: "0 0 40px rgba(204, 255, 0, 0.5)" },
        },
        "slide-up": {
          from: { transform: "translateY(100%)", opacity: "0" },
          to: { transform: "translateY(0)", opacity: "1" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "pulse-glow": "pulse-glow 2s ease-in-out infinite",
        "slide-up": "slide-up 0.5s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}


--- /app/frontend/.env (template) ---

REACT_APP_BACKEND_URL=http://localhost:8001


========== FRONTEND SOURCE ==========


--- /app/frontend/src/index.js ---

import React from "react";
import ReactDOM from "react-dom/client";
import "@/index.css";
import App from "@/App";

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);


--- /app/frontend/src/index.css ---

@import url('https://fonts.googleapis.com/css2?family=Chivo:wght@400;700;900&family=Manrope:wght@400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Dark theme (default) */
  :root {
    --background: 0 0% 2%;
    --foreground: 0 0% 100%;
    --card: 0 0% 7%;
    --card-foreground: 0 0% 100%;
    --popover: 0 0% 7%;
    --popover-foreground: 0 0% 100%;
    --primary: 75 100% 50%;
    --primary-foreground: 0 0% 0%;
    --secondary: 270 100% 50%;
    --secondary-foreground: 0 0% 100%;
    --muted: 240 4% 16%;
    --muted-foreground: 240 5% 65%;
    --accent: 75 100% 50%;
    --accent-foreground: 0 0% 0%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 4% 16%;
    --input: 240 4% 16%;
    --ring: 75 100% 50%;
    --radius: 0.75rem;
  }

  /* Light theme */
  .light {
    --background: 0 0% 98%;
    --foreground: 0 0% 9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 9%;
    --primary: 75 100% 40%;
    --primary-foreground: 0 0% 0%;
    --secondary: 270 100% 50%;
    --secondary-foreground: 0 0% 100%;
    --muted: 240 5% 92%;
    --muted-foreground: 240 4% 46%;
    --accent: 75 100% 40%;
    --accent-foreground: 0 0% 0%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 0 0% 98%;
    --border: 240 6% 85%;
    --input: 240 6% 85%;
    --ring: 75 100% 40%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground font-sans;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  html {
    scroll-behavior: smooth;
  }
}

/* Hide scrollbars for feed */
.hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.hide-scrollbar::-webkit-scrollbar {
  display: none;
}

/* Snap scroll container */
.snap-container {
  scroll-snap-type: y mandatory;
  overflow-y: scroll;
  height: 100dvh;
}

.snap-item {
  scroll-snap-align: start;
  scroll-snap-stop: always;
}

/* Glass effect - adapts to theme */
.glass {
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.light .glass {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

/* Gradient overlay for game cards */
.game-overlay {
  background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 40%, transparent 100%);
}

/* Primary button glow - adapts to theme */
.btn-glow {
  box-shadow: 0 0 20px rgba(204, 255, 0, 0.3);
}
.btn-glow:hover {
  box-shadow: 0 0 30px rgba(204, 255, 0, 0.5);
}

.light .btn-glow {
  box-shadow: 0 0 20px rgba(128, 204, 0, 0.4);
}
.light .btn-glow:hover {
  box-shadow: 0 0 30px rgba(128, 204, 0, 0.6);
}

/* Safe area padding for mobile */
.pb-safe {
  padding-bottom: env(safe-area-inset-bottom, 20px);
}

/* Touch optimization */
.touch-target {
  min-height: 44px;
  min-width: 44px;
}

/* Loading shimmer - adapts to theme */
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
.shimmer {
  background: linear-gradient(90deg, #121212 25%, #1a1a1a 50%, #121212 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

.light .shimmer {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
}

/* Game card hover effect */
.game-card-hover {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.game-card-hover:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 40px rgba(204, 255, 0, 0.15);
}

.light .game-card-hover:hover {
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
}

/* Category tile effect */
.category-tile {
  position: relative;
  overflow: hidden;
}

.category-tile::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(204, 255, 0, 0.1) 0%,
    transparent 50%
  );
  opacity: 0;
  transition: opacity 0.3s ease;
}

.category-tile:hover::before {
  opacity: 1;
}

/* Neon text effect */
.neon-text {
  text-shadow: 
    0 0 10px rgba(204, 255, 0, 0.5),
    0 0 20px rgba(204, 255, 0, 0.3),
    0 0 30px rgba(204, 255, 0, 0.2);
}

.light .neon-text {
  text-shadow: none;
}

/* Pulse animation for play button */
@keyframes pulse-ring {
  0% {
    transform: scale(0.8);
    opacity: 1;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

.pulse-ring::before {
  content: "";
  position: absolute;
  inset: -10px;
  border: 2px solid #CCFF00;
  border-radius: 50%;
  animation: pulse-ring 1.5s ease-out infinite;
}

/* Font classes */
.font-heading {
  font-family: "Chivo", sans-serif;
  font-weight: 900;
}

.font-body {
  font-family: "Manrope", sans-serif;
}

/* Light theme specific text colors */
.light .text-white {
  color: hsl(var(--foreground));
}

/* Glow lime adapts to theme */
.glow-lime {
  box-shadow: 0 0 20px rgba(204, 255, 0, 0.3);
}

.glow-lime:hover {
  box-shadow: 0 0 30px rgba(204, 255, 0, 0.5);
}

.light .glow-lime {
  box-shadow: 0 0 15px rgba(128, 204, 0, 0.3);
}

.light .glow-lime:hover {
  box-shadow: 0 0 25px rgba(128, 204, 0, 0.5);
}

/* Debug wrapper fix */
@layer base {
  [data-debug-wrapper="true"] {
    display: contents !important;
  }
}

/* Light theme card borders */
.light .border-white\/5 {
  border-color: rgba(0, 0, 0, 0.08);
}

.light .border-white\/10 {
  border-color: rgba(0, 0, 0, 0.1);
}

/* Light theme backgrounds */
.light .bg-black\/40 {
  background-color: rgba(0, 0, 0, 0.3);
}

.light .bg-black\/60 {
  background-color: rgba(0, 0, 0, 0.4);
}

/* Lime color adjustments for light theme */
.light .text-lime {
  color: hsl(75, 100%, 35%);
}

.light .bg-lime {
  background-color: hsl(75, 100%, 45%);
}

.light .bg-lime\/20 {
  background-color: hsla(75, 100%, 45%, 0.2);
}

.light .border-lime {
  border-color: hsl(75, 100%, 35%);
}

.light .border-lime\/30 {
  border-color: hsla(75, 100%, 35%, 0.3);
}

/* Ensure readable text in light mode overlays */
.light .game-overlay {
  background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.5) 40%, transparent 100%);
}

/* Game feed specific - keep text white on game cards */
.game-feed-content {
  color: white;
}

.game-feed-content h2,
.game-feed-content p,
.game-feed-content span {
  color: white;
}


--- /app/frontend/src/App.js ---

import { useState, useEffect, createContext, useContext } from "react";
import "@/App.css";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { Toaster } from "@/components/ui/sonner";
import { AnimatePresence } from "framer-motion";
import "@fontsource/chivo/900.css";
import "@fontsource/manrope/400.css";
import "@fontsource/manrope/500.css";
import "@fontsource/manrope/600.css";
import "@fontsource/manrope/700.css";

// Pages
import GameFeed from "@/pages/GameFeed";
import Explore from "@/pages/Explore";
import Pro from "@/pages/Pro";
import Profile from "@/pages/Profile";
import AdminDashboard from "@/pages/AdminDashboard";
import GamePlayer from "@/pages/GamePlayer";
import AnalyticsDashboard from "@/pages/AnalyticsDashboard";

// Components
import BottomNav from "@/components/BottomNav";

// Contexts
import { ThemeProvider } from "@/contexts/ThemeContext";

// Context
const AuthContext = createContext(null);

export const useAuth = () => useContext(AuthContext);

const API = `${process.env.REACT_APP_BACKEND_URL}/api`;

function AppContent() {
  const location = useLocation();
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [loading, setLoading] = useState(true);
  const [settings, setSettings] = useState({ logo_url: null });

  // Hide bottom nav on game player
  const hideNav = location.pathname.startsWith("/play/");

  useEffect(() => {
    const fetchUser = async () => {
      if (!token) {
        setLoading(false);
        return;
      }
      try {
        const res = await fetch(`${API}/auth/me`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.ok) {
          const userData = await res.json();
          setUser(userData);
        } else {
          localStorage.removeItem("token");
          setToken(null);
        }
      } catch (e) {
        console.error("Auth error:", e);
      }
      setLoading(false);
    };
    fetchUser();
  }, [token]);

  useEffect(() => {
    const fetchSettings = async () => {
      try {
        const res = await fetch(`${API}/settings`);
        if (res.ok) {
          const data = await res.json();
          setSettings(data);
        }
      } catch (e) {
        console.error("Settings error:", e);
      }
    };
    fetchSettings();
  }, []);

  const login = async (email, password) => {
    const res = await fetch(`${API}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Login failed");
    localStorage.setItem("token", data.access_token);
    setToken(data.access_token);
    setUser(data.user);
    return data.user;
  };

  const register = async (username, email, password) => {
    const res = await fetch(`${API}/auth/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Registration failed");
    localStorage.setItem("token", data.access_token);
    setToken(data.access_token);
    setUser(data.user);
    return data.user;
  };

  const logout = () => {
    localStorage.removeItem("token");
    setToken(null);
    setUser(null);
  };

  const authValue = {
    user,
    token,
    loading,
    settings,
    login,
    register,
    logout,
    setSettings,
    API
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="w-12 h-12 border-4 border-lime border-t-transparent rounded-full animate-spin" />
      </div>
    );
  }

  return (
    <AuthContext.Provider value={authValue}>
      <div className="min-h-screen bg-background transition-colors duration-300">
        <AnimatePresence mode="wait">
          <Routes location={location} key={location.pathname}>
            <Route path="/" element={<GameFeed />} />
            <Route path="/explore" element={<Explore />} />
            <Route path="/pro" element={<Pro />} />
            <Route path="/profile" element={<Profile />} />
            <Route path="/admin" element={<AdminDashboard />} />
            <Route path="/admin/analytics" element={<AnalyticsDashboard />} />
            <Route path="/play/:gameId" element={<GamePlayer />} />
          </Routes>
        </AnimatePresence>
        {!hideNav && <BottomNav />}
        <Toaster position="top-center" richColors />
      </div>
    </AuthContext.Provider>
  );
}

function App() {
  return (
    <ThemeProvider>
      <BrowserRouter>
        <AppContent />
      </BrowserRouter>
    </ThemeProvider>
  );
}

export default App;


--- /app/frontend/src/App.css ---

/* Hypd Games - Main Styles */

/* Custom scrollbar hide */
.hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.hide-scrollbar::-webkit-scrollbar {
  display: none;
}

/* Snap scroll container */
.snap-container {
  scroll-snap-type: y mandatory;
  overflow-y: scroll;
  height: 100dvh;
}

.snap-item {
  scroll-snap-align: start;
  scroll-snap-stop: always;
}

/* Game overlay gradient */
.game-overlay {
  background: linear-gradient(
    to top,
    rgba(0, 0, 0, 0.95) 0%,
    rgba(0, 0, 0, 0.6) 30%,
    rgba(0, 0, 0, 0.2) 60%,
    transparent 100%
  );
}

/* Glassmorphism */
.glass {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Primary glow effect */
.glow-lime {
  box-shadow: 0 0 20px rgba(204, 255, 0, 0.3);
}

.glow-lime:hover {
  box-shadow: 0 0 30px rgba(204, 255, 0, 0.5);
}

/* Safe area padding */
.pb-safe {
  padding-bottom: max(env(safe-area-inset-bottom), 20px);
}

/* Touch targets */
.touch-target {
  min-height: 44px;
  min-width: 44px;
}

/* Loading shimmer */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.shimmer {
  background: linear-gradient(
    90deg,
    #121212 25%,
    #1a1a1a 50%,
    #121212 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* Game card hover effect */
.game-card-hover {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.game-card-hover:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 40px rgba(204, 255, 0, 0.15);
}

/* Category tile effect */
.category-tile {
  position: relative;
  overflow: hidden;
}

.category-tile::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(204, 255, 0, 0.1) 0%,
    transparent 50%
  );
  opacity: 0;
  transition: opacity 0.3s ease;
}

.category-tile:hover::before {
  opacity: 1;
}

/* Neon text effect */
.neon-text {
  text-shadow: 
    0 0 10px rgba(204, 255, 0, 0.5),
    0 0 20px rgba(204, 255, 0, 0.3),
    0 0 30px rgba(204, 255, 0, 0.2);
}

/* Pulse animation for play button */
@keyframes pulse-ring {
  0% {
    transform: scale(0.8);
    opacity: 1;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

.pulse-ring::before {
  content: "";
  position: absolute;
  inset: -10px;
  border: 2px solid #CCFF00;
  border-radius: 50%;
  animation: pulse-ring 1.5s ease-out infinite;
}

/* Font classes */
.font-heading {
  font-family: "Chivo", sans-serif;
  font-weight: 900;
}

.font-body {
  font-family: "Manrope", sans-serif;
}


========== CONTEXTS ==========


--- /app/frontend/src/contexts/ThemeContext.jsx ---

import { createContext, useContext, useEffect, useState } from "react";

const ThemeContext = createContext(null);

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
};

export function ThemeProvider({ children }) {
  const [theme, setTheme] = useState(() => {
    // Check localStorage first, then system preference
    const saved = localStorage.getItem("hypd-theme");
    if (saved) return saved;
    
    if (typeof window !== "undefined" && window.matchMedia) {
      return window.matchMedia("(prefers-color-scheme: light)").matches ? "light" : "dark";
    }
    return "dark";
  });

  useEffect(() => {
    const root = document.documentElement;
    
    if (theme === "light") {
      root.classList.add("light");
      root.classList.remove("dark");
    } else {
      root.classList.add("dark");
      root.classList.remove("light");
    }
    
    localStorage.setItem("hypd-theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === "dark" ? "light" : "dark");
  };

  return (
    <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}


========== COMPONENTS ==========


--- /app/frontend/src/components/BottomNav.jsx ---

import { NavLink } from "react-router-dom";
import { Home, Compass, Crown, User } from "lucide-react";

const navItems = [
  { path: "/", icon: Home, label: "Feed" },
  { path: "/explore", icon: Compass, label: "Explore" },
  { path: "/pro", icon: Crown, label: "PRO" },
  { path: "/profile", icon: User, label: "Profile" }
];

export default function BottomNav() {
  return (
    <nav 
      className="fixed bottom-0 left-0 right-0 glass border-t border-border z-50 pb-safe"
      data-testid="bottom-navigation"
    >
      <div className="flex justify-around items-center h-16 max-w-md mx-auto">
        {navItems.map(({ path, icon: Icon, label }) => (
          <NavLink
            key={path}
            to={path}
            className={({ isActive }) =>
              `flex flex-col items-center justify-center w-16 h-full touch-target transition-all duration-200 ${
                isActive 
                  ? "text-lime" 
                  : "text-muted-foreground hover:text-foreground"
              }`
            }
            data-testid={`nav-${label.toLowerCase()}`}
          >
            {({ isActive }) => (
              <>
                <Icon 
                  className={`w-6 h-6 transition-transform duration-200 ${
                    isActive ? "scale-110" : ""
                  }`} 
                  strokeWidth={isActive ? 2.5 : 1.5}
                />
                <span className={`text-xs mt-1 font-medium ${
                  isActive ? "font-bold" : ""
                }`}>
                  {label}
                </span>
              </>
            )}
          </NavLink>
        ))}
      </div>
    </nav>
  );
}


--- /app/frontend/src/components/ThemeToggle.jsx ---

import { Sun, Moon } from "lucide-react";
import { useTheme } from "@/contexts/ThemeContext";

export default function ThemeToggle({ className = "" }) {
  const { theme, toggleTheme } = useTheme();
  
  return (
    <button
      onClick={toggleTheme}
      className={`w-10 h-10 rounded-full glass flex items-center justify-center touch-target transition-all hover:scale-105 active:scale-95 ${className}`}
      data-testid="theme-toggle"
      aria-label={`Switch to ${theme === 'dark' ? 'light' : 'dark'} mode`}
    >
      {theme === "dark" ? (
        <Sun className="w-5 h-5 text-yellow-400" />
      ) : (
        <Moon className="w-5 h-5 text-slate-600" />
      )}
    </button>
  );
}


========== PAGES ==========


--- /app/frontend/src/pages/GameFeed.jsx ---

import { useState, useEffect, useRef, useCallback } from "react";
import { useNavigate } from "react-router-dom";
import { motion, AnimatePresence } from "framer-motion";
import { Play, Volume2, VolumeX, Heart, Share2, Loader2 } from "lucide-react";
import { useAuth } from "@/App";
import { toast } from "sonner";
import ThemeToggle from "@/components/ThemeToggle";

export default function GameFeed() {
  const { API, user, token, settings } = useAuth();
  const navigate = useNavigate();
  const [games, setGames] = useState([]);
  const [loading, setLoading] = useState(true);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [muted, setMuted] = useState(true);
  const [savedGames, setSavedGames] = useState(new Set(user?.saved_games || []));
  const containerRef = useRef(null);

  useEffect(() => {
    const fetchGames = async () => {
      try {
        const res = await fetch(`${API}/games`);
        if (res.ok) {
          const data = await res.json();
          setGames(data);
        }
      } catch (e) {
        console.error("Error fetching games:", e);
      }
      setLoading(false);
    };
    fetchGames();
  }, [API]);

  useEffect(() => {
    if (user?.saved_games) {
      setSavedGames(new Set(user.saved_games));
    }
  }, [user]);

  const handleScroll = useCallback(() => {
    if (!containerRef.current) return;
    const scrollTop = containerRef.current.scrollTop;
    const itemHeight = window.innerHeight;
    const newIndex = Math.round(scrollTop / itemHeight);
    if (newIndex !== currentIndex && newIndex >= 0 && newIndex < games.length) {
      setCurrentIndex(newIndex);
    }
  }, [currentIndex, games.length]);

  const playGame = (gameId) => {
    navigate(`/play/${gameId}`);
  };

  const toggleSave = async (gameId, e) => {
    e.stopPropagation();
    if (!user) {
      toast.error("Please login to save games");
      navigate("/profile");
      return;
    }

    const isSaved = savedGames.has(gameId);
    try {
      const res = await fetch(`${API}/auth/save-game/${gameId}`, {
        method: isSaved ? "DELETE" : "POST",
        headers: { Authorization: `Bearer ${token}` }
      });
      if (res.ok) {
        setSavedGames(prev => {
          const next = new Set(prev);
          if (isSaved) next.delete(gameId);
          else next.add(gameId);
          return next;
        });
        toast.success(isSaved ? "Removed from saved" : "Game saved!");
      }
    } catch (e) {
      toast.error("Failed to save game");
    }
  };

  const shareGame = async (game, e) => {
    e.stopPropagation();
    try {
      if (navigator.share) {
        await navigator.share({
          title: game.title,
          text: game.description,
          url: `${window.location.origin}/play/${game.id}`
        });
      } else {
        await navigator.clipboard.writeText(`${window.location.origin}/play/${game.id}`);
        toast.success("Link copied to clipboard!");
      }
    } catch (e) {
      console.error("Share error:", e);
    }
  };

  if (loading) {
    return (
      <div className="h-screen flex items-center justify-center bg-background">
        <Loader2 className="w-10 h-10 text-lime animate-spin" />
      </div>
    );
  }

  if (games.length === 0) {
    return (
      <div className="h-screen flex flex-col items-center justify-center bg-background p-8 text-center">
        <div className="w-20 h-20 rounded-full bg-card flex items-center justify-center mb-6">
          <Play className="w-10 h-10 text-lime" />
        </div>
        <h2 className="text-2xl font-heading text-foreground mb-2">No Games Yet</h2>
        <p className="text-muted-foreground mb-6">
          Games will appear here once added by admin
        </p>
      </div>
    );
  }

  return (
    <div 
      ref={containerRef}
      className="snap-container hide-scrollbar"
      onScroll={handleScroll}
      data-testid="game-feed"
    >
      {/* Header */}
      <div className="fixed top-0 left-0 right-0 z-40 p-4 flex justify-between items-center">
        {settings?.logo_url ? (
          <img src={settings.logo_url} alt="Logo" className="h-8" />
        ) : (
          <h1 className="font-heading text-xl text-lime tracking-tight">
            HYPD
          </h1>
        )}
        <div className="flex items-center gap-2">
          <ThemeToggle />
          <button
            onClick={() => setMuted(!muted)}
            className="w-10 h-10 rounded-full glass flex items-center justify-center touch-target"
            data-testid="mute-button"
          >
            {muted ? (
              <VolumeX className="w-5 h-5 text-foreground" />
            ) : (
              <Volume2 className="w-5 h-5 text-foreground" />
            )}
          </button>
        </div>
      </div>

      {/* Game Cards */}
      {games.map((game, index) => (
        <div
          key={game.id}
          className="snap-item h-[100dvh] w-full relative overflow-hidden"
          data-testid={`game-card-${index}`}
        >
          {/* Background Image */}
          <div 
            className="absolute inset-0 bg-cover bg-center"
            style={{ 
              backgroundImage: `url(${game.thumbnail_url || 'https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=800&q=80'})` 
            }}
          >
            <div className="absolute inset-0 bg-black/40" />
          </div>

          {/* Overlay Gradient */}
          <div className="absolute inset-0 game-overlay" />

          {/* Content - Text stays white on game cards since they have dark overlay */}
          <div className="absolute inset-0 flex flex-col justify-end p-6 pb-24">
            {/* Game Info */}
            <div className="flex items-end justify-between gap-4">
              <div className="flex-1">
                <span className="inline-block px-3 py-1 text-xs font-bold uppercase tracking-wider bg-lime text-black rounded-full mb-3">
                  {game.category}
                </span>
                <h2 className="font-heading text-3xl md:text-4xl text-white mb-2 leading-tight">
                  {game.title}
                </h2>
                <p className="text-white/70 text-sm line-clamp-2 mb-4">
                  {game.description}
                </p>
                <div className="flex items-center gap-2 text-white/50 text-xs">
                  <span>{game.play_count?.toLocaleString() || 0} plays</span>
                </div>
              </div>

              {/* Side Actions */}
              <div className="flex flex-col items-center gap-4">
                <button
                  onClick={(e) => toggleSave(game.id, e)}
                  className="w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center touch-target transition-transform active:scale-90"
                  data-testid={`save-game-${index}`}
                >
                  <Heart 
                    className={`w-6 h-6 transition-colors ${
                      savedGames.has(game.id) 
                        ? "fill-red-500 text-red-500" 
                        : "text-white"
                    }`} 
                  />
                </button>
                <button
                  onClick={(e) => shareGame(game, e)}
                  className="w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center touch-target transition-transform active:scale-90"
                  data-testid={`share-game-${index}`}
                >
                  <Share2 className="w-6 h-6 text-white" />
                </button>
              </div>
            </div>

            {/* Play Button */}
            <AnimatePresence>
              {index === currentIndex && (
                <motion.button
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: 20 }}
                  onClick={() => playGame(game.id)}
                  className="mt-6 w-full py-4 bg-lime text-black font-heading text-lg uppercase tracking-widest rounded-full glow-lime transition-transform active:scale-95"
                  data-testid={`play-button-${index}`}
                >
                  Play Now
                </motion.button>
              )}
            </AnimatePresence>
          </div>

          {/* Scroll Indicator */}
          {index === 0 && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 1 }}
              className="absolute bottom-32 left-1/2 -translate-x-1/2 flex flex-col items-center text-white/50"
            >
              <motion.div
                animate={{ y: [0, 8, 0] }}
                transition={{ repeat: Infinity, duration: 1.5 }}
                className="w-6 h-10 rounded-full border-2 border-white/30 flex items-start justify-center p-1"
              >
                <div className="w-1.5 h-3 bg-white/50 rounded-full" />
              </motion.div>
              <span className="text-xs mt-2">Swipe for more</span>
            </motion.div>
          )}
        </div>
      ))}

      {/* Bottom Padding for Nav */}
      <div className="h-20" />
    </div>
  );
}


--- /app/frontend/src/pages/GamePlayer.jsx ---

import { useState, useEffect, useRef, useCallback } from "react";
import { useParams, useNavigate } from "react-router-dom";
import { ArrowLeft, Loader2 } from "lucide-react";
import { useAuth } from "@/App";

export default function GamePlayer() {
  const { gameId } = useParams();
  const navigate = useNavigate();
  const { API, token, user } = useAuth();
  const iframeRef = useRef(null);
  const startTimeRef = useRef(null);
  
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [gameUrl, setGameUrl] = useState(null);
  const [buttonY, setButtonY] = useState(100);
  const [isDragging, setIsDragging] = useState(false);
  const dragStartY = useRef(0);
  const buttonStartY = useRef(0);

  useEffect(() => {
    // Set game URL and start tracking time
    setGameUrl(`${API}/games/${gameId}/play`);
    startTimeRef.current = Date.now();
    
    // Simulate loading time for iframe
    const timer = setTimeout(() => {
      setLoading(false);
    }, 1500);

    // Cleanup: record play session on unmount
    return () => {
      clearTimeout(timer);
      recordPlaySession();
    };
  }, [gameId, API]);

  const recordPlaySession = async () => {
    if (!startTimeRef.current) return;
    
    const durationSeconds = Math.round((Date.now() - startTimeRef.current) / 1000);
    
    // Only record sessions longer than 3 seconds
    if (durationSeconds < 3) return;
    
    try {
      await fetch(`${API}/analytics/play-session`, {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          ...(token ? { Authorization: `Bearer ${token}` } : {})
        },
        body: JSON.stringify({
          game_id: gameId,
          duration_seconds: durationSeconds,
          score: null
        })
      });
    } catch (e) {
      console.error("Failed to record play session:", e);
    }
  };

  const handleDragStart = useCallback((e) => {
    e.preventDefault();
    setIsDragging(true);
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    dragStartY.current = clientY;
    buttonStartY.current = buttonY;
  }, [buttonY]);

  const handleDragMove = useCallback((e) => {
    if (!isDragging) return;
    e.preventDefault();
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const deltaY = clientY - dragStartY.current;
    const newY = Math.max(50, Math.min(window.innerHeight - 150, buttonStartY.current + deltaY));
    setButtonY(newY);
  }, [isDragging]);

  const handleDragEnd = useCallback(() => {
    setIsDragging(false);
  }, []);

  useEffect(() => {
    if (isDragging) {
      window.addEventListener("mousemove", handleDragMove);
      window.addEventListener("mouseup", handleDragEnd);
      window.addEventListener("touchmove", handleDragMove, { passive: false });
      window.addEventListener("touchend", handleDragEnd);
    }
    return () => {
      window.removeEventListener("mousemove", handleDragMove);
      window.removeEventListener("mouseup", handleDragEnd);
      window.removeEventListener("touchmove", handleDragMove);
      window.removeEventListener("touchend", handleDragEnd);
    };
  }, [isDragging, handleDragMove, handleDragEnd]);

  const handleBack = () => {
    // Record session before navigating
    recordPlaySession();
    navigate(-1);
  };

  if (error) {
    return (
      <div className="fixed inset-0 bg-background flex flex-col items-center justify-center p-8 text-center">
        <div className="w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
          <ArrowLeft className="w-8 h-8 text-red-500" />
        </div>
        <h2 className="text-xl font-heading text-white mb-2">Game Not Found</h2>
        <p className="text-muted-foreground mb-6">{error}</p>
        <button
          onClick={handleBack}
          className="px-6 py-3 bg-lime text-black font-bold rounded-full"
        >
          Go Back
        </button>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black z-50" data-testid="game-player">
      {/* Loading Overlay */}
      {loading && (
        <div className="absolute inset-0 bg-background flex flex-col items-center justify-center z-20">
          <Loader2 className="w-12 h-12 text-lime animate-spin mb-4" />
          <p className="text-white font-medium">Loading game...</p>
        </div>
      )}

      {/* Game iFrame */}
      {gameUrl && (
        <iframe
          ref={iframeRef}
          src={gameUrl}
          className="w-full h-full border-0"
          title="Game Player"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowFullScreen
          onLoad={() => setLoading(false)}
          onError={() => {
            setError("Failed to load game");
            setLoading(false);
          }}
        />
      )}

      {/* Draggable Back Button */}
      <button
        onMouseDown={handleDragStart}
        onTouchStart={handleDragStart}
        onClick={(e) => {
          // Only navigate if not dragging
          if (!isDragging) {
            handleBack();
          }
        }}
        className={`fixed left-4 z-30 w-12 h-12 rounded-full glass flex items-center justify-center touch-target transition-all ${
          isDragging ? "scale-110 ring-2 ring-lime" : ""
        }`}
        style={{ top: `${buttonY}px` }}
        data-testid="back-button"
      >
        <ArrowLeft className="w-6 h-6 text-white" />
      </button>

      {/* Drag hint */}
      {!isDragging && (
        <div 
          className="fixed left-4 z-20 text-xs text-white/40 pointer-events-none transition-opacity"
          style={{ top: `${buttonY + 56}px` }}
        >
          Drag me
        </div>
      )}
    </div>
  );
}


--- /app/frontend/src/pages/Explore.jsx ---

import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import { Search, Gamepad2, Zap, Brain, Rocket, Target, Loader2 } from "lucide-react";
import { Input } from "@/components/ui/input";
import { useAuth } from "@/App";
import ThemeToggle from "@/components/ThemeToggle";

const categoryIcons = {
  "Action": Zap,
  "Puzzle": Brain,
  "Arcade": Gamepad2,
  "Racing": Rocket,
  "Sports": Target
};

export default function Explore() {
  const { API, settings } = useAuth();
  const navigate = useNavigate();
  const [games, setGames] = useState([]);
  const [categories, setCategories] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedCategory, setSelectedCategory] = useState("all");

  useEffect(() => {
    const fetchData = async () => {
      try {
        const [gamesRes, categoriesRes] = await Promise.all([
          fetch(`${API}/games`),
          fetch(`${API}/categories`)
        ]);
        
        if (gamesRes.ok) {
          const gamesData = await gamesRes.json();
          setGames(gamesData);
        }
        
        if (categoriesRes.ok) {
          const categoriesData = await categoriesRes.json();
          setCategories(categoriesData.categories || []);
        }
      } catch (e) {
        console.error("Error fetching data:", e);
      }
      setLoading(false);
    };
    fetchData();
  }, [API]);

  const filteredGames = games.filter(game => {
    const matchesSearch = game.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         game.description.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesCategory = selectedCategory === "all" || game.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  const playGame = (gameId) => {
    navigate(`/play/${gameId}`);
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <Loader2 className="w-10 h-10 text-lime animate-spin" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background pb-24" data-testid="explore-page">
      {/* Header */}
      <div className="sticky top-0 z-30 glass p-4 border-b border-border">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-4">
            {settings?.logo_url ? (
              <img src={settings.logo_url} alt="Logo" className="h-8" />
            ) : (
              <h1 className="font-heading text-xl text-lime tracking-tight">HYPD</h1>
            )}
            <span className="text-muted-foreground">Explore</span>
          </div>
          <ThemeToggle />
        </div>
        
        {/* Search */}
        <div className="relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
          <Input
            type="text"
            placeholder="Search games..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="pl-12 h-12 bg-card border-border rounded-xl text-foreground placeholder:text-muted-foreground"
            data-testid="search-input"
          />
        </div>
      </div>

      <div className="p-4">
        {/* Categories */}
        <section className="mb-8">
          <h2 className="text-lg font-bold text-foreground mb-4">Categories</h2>
          <div className="flex gap-3 overflow-x-auto hide-scrollbar pb-2">
            <button
              onClick={() => setSelectedCategory("all")}
              className={`flex-shrink-0 px-5 py-3 rounded-full font-medium transition-all ${
                selectedCategory === "all"
                  ? "bg-lime text-black"
                  : "bg-card text-foreground border border-border hover:border-lime/50"
              }`}
              data-testid="category-all"
            >
              All Games
            </button>
            {categories.map(category => {
              const Icon = categoryIcons[category] || Gamepad2;
              return (
                <button
                  key={category}
                  onClick={() => setSelectedCategory(category)}
                  className={`flex-shrink-0 flex items-center gap-2 px-5 py-3 rounded-full font-medium transition-all ${
                    selectedCategory === category
                      ? "bg-lime text-black"
                      : "bg-card text-foreground border border-border hover:border-lime/50"
                  }`}
                  data-testid={`category-${category.toLowerCase()}`}
                >
                  <Icon className="w-4 h-4" />
                  {category}
                </button>
              );
            })}
          </div>
        </section>

        {/* Games Grid */}
        <section>
          <h2 className="text-lg font-bold text-foreground mb-4">
            {selectedCategory === "all" ? "All Games" : selectedCategory}
            <span className="text-muted-foreground font-normal ml-2">
              ({filteredGames.length})
            </span>
          </h2>
          
          {filteredGames.length === 0 ? (
            <div className="text-center py-12">
              <Gamepad2 className="w-12 h-12 text-muted-foreground mx-auto mb-4" />
              <p className="text-muted-foreground">No games found</p>
            </div>
          ) : (
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              {filteredGames.map((game, index) => (
                <motion.div
                  key={game.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.05 }}
                  onClick={() => playGame(game.id)}
                  className="group cursor-pointer game-card-hover"
                  data-testid={`explore-game-${index}`}
                >
                  <div className="aspect-square relative overflow-hidden rounded-2xl bg-card border border-border group-hover:border-lime/50 transition-colors">
                    {/* Background Image */}
                    <img
                      src={game.thumbnail_url || "https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=400&q=80"}
                      alt={game.title}
                      className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                      loading="lazy"
                    />
                    
                    {/* Overlay - always dark for readability */}
                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent" />
                    
                    {/* Category Badge */}
                    <div className="absolute top-3 left-3">
                      <span className="px-2 py-1 text-[10px] font-bold uppercase tracking-wider bg-black/60 backdrop-blur-sm text-white rounded-full">
                        {game.category}
                      </span>
                    </div>
                    
                    {/* Title - white on dark overlay */}
                    <div className="absolute bottom-0 left-0 right-0 p-3">
                      <h3 className="font-heading text-sm text-white truncate">
                        {game.title}
                      </h3>
                      <p className="text-xs text-white/50 mt-1">
                        {game.play_count?.toLocaleString() || 0} plays
                      </p>
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>
          )}
        </section>
      </div>
    </div>
  );
}


--- /app/frontend/src/pages/Pro.jsx ---

import { motion } from "framer-motion";
import { Crown, Zap, Shield, Star, Check, Sparkles } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useAuth } from "@/App";
import ThemeToggle from "@/components/ThemeToggle";

const features = [
  {
    icon: Zap,
    title: "Ad-Free Gaming",
    description: "Play without any interruptions or ads"
  },
  {
    icon: Shield,
    title: "Exclusive Games",
    description: "Access PRO-only titles before anyone else"
  },
  {
    icon: Star,
    title: "Priority Support",
    description: "Get help faster with dedicated support"
  },
  {
    icon: Sparkles,
    title: "Custom Themes",
    description: "Personalize your gaming experience"
  }
];

const plans = [
  {
    name: "Monthly",
    price: "$4.99",
    period: "/month",
    popular: false
  },
  {
    name: "Yearly",
    price: "$39.99",
    period: "/year",
    popular: true,
    savings: "Save 33%"
  }
];

export default function Pro() {
  const { settings } = useAuth();

  const handleSubscribe = (plan) => {
    alert(`Subscription to ${plan} plan coming soon!`);
  };

  return (
    <div className="min-h-screen bg-background pb-24 overflow-hidden" data-testid="pro-page">
      {/* Header */}
      <div className="glass p-4 border-b border-border sticky top-0 z-30">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            {settings?.logo_url ? (
              <img src={settings.logo_url} alt="Logo" className="h-8" />
            ) : (
              <h1 className="font-heading text-xl text-lime tracking-tight">HYPD</h1>
            )}
            <span className="text-muted-foreground">PRO</span>
          </div>
          <ThemeToggle />
        </div>
      </div>

      {/* Hero Section */}
      <div className="relative">
        {/* Background Glow */}
        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-violet/30 via-background to-background" />
        
        {/* Content */}
        <div className="relative px-6 pt-8 pb-8 text-center">
          {/* Crown Icon */}
          <motion.div
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ type: "spring", duration: 0.6 }}
            className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-lime/20 to-violet/20 border border-lime/30 mb-6"
          >
            <Crown className="w-10 h-10 text-lime" />
          </motion.div>

          <motion.h1
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="font-heading text-4xl md:text-5xl text-foreground mb-4"
          >
            GO <span className="text-lime neon-text">PRO</span>
          </motion.h1>

          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="text-muted-foreground max-w-md mx-auto"
          >
            Unlock the ultimate gaming experience with no ads, exclusive games, and premium features.
          </motion.p>
        </div>
      </div>

      {/* Features */}
      <div className="px-6 py-8">
        <h2 className="text-lg font-bold text-foreground mb-6 text-center">What You Get</h2>
        <div className="grid grid-cols-2 gap-4 max-w-md mx-auto">
          {features.map((feature, index) => {
            const Icon = feature.icon;
            return (
              <motion.div
                key={feature.title}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4 + index * 0.1 }}
                className="bg-card border border-border rounded-2xl p-4 text-center"
              >
                <div className="w-12 h-12 rounded-xl bg-lime/10 flex items-center justify-center mx-auto mb-3">
                  <Icon className="w-6 h-6 text-lime" />
                </div>
                <h3 className="font-bold text-foreground text-sm mb-1">{feature.title}</h3>
                <p className="text-xs text-muted-foreground">{feature.description}</p>
              </motion.div>
            );
          })}
        </div>
      </div>

      {/* Pricing Plans */}
      <div className="px-6 py-8">
        <h2 className="text-lg font-bold text-foreground mb-6 text-center">Choose Your Plan</h2>
        <div className="flex flex-col md:flex-row gap-4 max-w-md mx-auto">
          {plans.map((plan, index) => (
            <motion.div
              key={plan.name}
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.6 + index * 0.1 }}
              className={`flex-1 relative bg-card border rounded-2xl p-6 ${
                plan.popular 
                  ? "border-lime ring-2 ring-lime/20" 
                  : "border-border"
              }`}
              data-testid={`plan-${plan.name.toLowerCase()}`}
            >
              {plan.popular && (
                <div className="absolute -top-3 left-1/2 -translate-x-1/2">
                  <span className="px-4 py-1 bg-lime text-black text-xs font-bold rounded-full">
                    BEST VALUE
                  </span>
                </div>
              )}
              
              <div className="text-center mb-6">
                <h3 className="text-foreground font-bold mb-2">{plan.name}</h3>
                <div className="flex items-baseline justify-center gap-1">
                  <span className="text-3xl font-heading text-foreground">{plan.price}</span>
                  <span className="text-muted-foreground text-sm">{plan.period}</span>
                </div>
                {plan.savings && (
                  <span className="text-lime text-xs font-medium">{plan.savings}</span>
                )}
              </div>

              <ul className="space-y-3 mb-6">
                {features.map(f => (
                  <li key={f.title} className="flex items-center gap-2 text-sm text-muted-foreground">
                    <Check className="w-4 h-4 text-lime flex-shrink-0" />
                    {f.title}
                  </li>
                ))}
              </ul>

              <Button
                onClick={() => handleSubscribe(plan.name)}
                className={`w-full py-6 font-bold rounded-full transition-all ${
                  plan.popular
                    ? "bg-lime text-black hover:bg-lime/90 glow-lime"
                    : "bg-muted text-foreground hover:bg-muted/80"
                }`}
                data-testid={`subscribe-${plan.name.toLowerCase()}`}
              >
                Subscribe
              </Button>
            </motion.div>
          ))}
        </div>
      </div>

      {/* Disclaimer */}
      <p className="text-center text-xs text-muted-foreground px-6 mt-4">
        Cancel anytime. No hidden fees. PRO membership auto-renews.
      </p>
    </div>
  );
}


--- /app/frontend/src/pages/Profile.jsx ---

import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import { 
  User, Mail, Lock, LogOut, Heart, Trophy, 
  ChevronRight, Eye, EyeOff, Loader2, Shield
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useAuth } from "@/App";
import { toast } from "sonner";
import ThemeToggle from "@/components/ThemeToggle";

export default function Profile() {
  const { user, login, register, logout, API, token, settings } = useAuth();
  const navigate = useNavigate();
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [savedGames, setSavedGames] = useState([]);
  
  // Form states
  const [loginForm, setLoginForm] = useState({ email: "", password: "" });
  const [registerForm, setRegisterForm] = useState({ 
    username: "", email: "", password: "", confirmPassword: "" 
  });

  const fetchSavedGames = async () => {
    try {
      if (!user?.saved_games?.length) return;
      
      const gamesRes = await fetch(`${API}/games`);
      if (gamesRes.ok) {
        const allGames = await gamesRes.json();
        const saved = allGames.filter(g => user.saved_games.includes(g.id));
        setSavedGames(saved);
      }
    } catch (e) {
      console.error("Error fetching saved games:", e);
    }
  };

  useEffect(() => {
    if (user && token) {
      fetchSavedGames();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [user, token]);

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      await login(loginForm.email, loginForm.password);
      toast.success("Welcome back!");
    } catch (err) {
      toast.error(err.message);
    }
    setLoading(false);
  };

  const handleRegister = async (e) => {
    e.preventDefault();
    if (registerForm.password !== registerForm.confirmPassword) {
      toast.error("Passwords don't match");
      return;
    }
    if (registerForm.password.length < 6) {
      toast.error("Password must be at least 6 characters");
      return;
    }
    setLoading(true);
    try {
      await register(registerForm.username, registerForm.email, registerForm.password);
      toast.success("Account created successfully!");
    } catch (err) {
      toast.error(err.message);
    }
    setLoading(false);
  };

  const handleLogout = () => {
    logout();
    toast.success("Logged out successfully");
  };

  // Logged out view
  if (!user) {
    return (
      <div className="min-h-screen bg-background pb-24" data-testid="profile-page">
        {/* Header */}
        <div className="glass p-4 border-b border-border">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              {settings?.logo_url ? (
                <img src={settings.logo_url} alt="Logo" className="h-8" />
              ) : (
                <h1 className="font-heading text-xl text-lime tracking-tight">HYPD</h1>
              )}
              <span className="text-muted-foreground">Profile</span>
            </div>
            <ThemeToggle />
          </div>
        </div>

        <div className="p-6 max-w-md mx-auto">
          {/* Welcome Message */}
          <div className="text-center mb-8">
            <div className="w-20 h-20 rounded-full bg-card border border-border flex items-center justify-center mx-auto mb-4">
              <User className="w-10 h-10 text-muted-foreground" />
            </div>
            <h2 className="font-heading text-2xl text-foreground mb-2">Join HYPD</h2>
            <p className="text-muted-foreground text-sm">
              Save your progress, track high scores, and more
            </p>
          </div>

          {/* Auth Tabs */}
          <Tabs defaultValue="login" className="w-full">
            <TabsList className="grid w-full grid-cols-2 bg-card border border-border rounded-xl p-1 h-auto">
              <TabsTrigger 
                value="login" 
                className="rounded-lg py-3 data-[state=active]:bg-lime data-[state=active]:text-black"
                data-testid="login-tab"
              >
                Login
              </TabsTrigger>
              <TabsTrigger 
                value="register"
                className="rounded-lg py-3 data-[state=active]:bg-lime data-[state=active]:text-black"
                data-testid="register-tab"
              >
                Sign Up
              </TabsTrigger>
            </TabsList>

            {/* Login Form */}
            <TabsContent value="login" className="mt-6">
              <form onSubmit={handleLogin} className="space-y-4">
                <div className="space-y-2">
                  <Label className="text-foreground">Email</Label>
                  <div className="relative">
                    <Mail className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type="email"
                      placeholder="you@example.com"
                      value={loginForm.email}
                      onChange={(e) => setLoginForm({ ...loginForm, email: e.target.value })}
                      className="pl-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="login-email"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label className="text-foreground">Password</Label>
                  <div className="relative">
                    <Lock className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type={showPassword ? "text" : "password"}
                      placeholder="••••••••"
                      value={loginForm.password}
                      onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                      className="pl-12 pr-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="login-password"
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
                    >
                      {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                    </button>
                  </div>
                </div>

                <Button
                  type="submit"
                  disabled={loading}
                  className="w-full h-12 bg-lime text-black font-bold rounded-xl hover:bg-lime/90"
                  data-testid="login-submit"
                >
                  {loading ? <Loader2 className="w-5 h-5 animate-spin" /> : "Login"}
                </Button>
              </form>
            </TabsContent>

            {/* Register Form */}
            <TabsContent value="register" className="mt-6">
              <form onSubmit={handleRegister} className="space-y-4">
                <div className="space-y-2">
                  <Label className="text-foreground">Username</Label>
                  <div className="relative">
                    <User className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type="text"
                      placeholder="gamer123"
                      value={registerForm.username}
                      onChange={(e) => setRegisterForm({ ...registerForm, username: e.target.value })}
                      className="pl-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="register-username"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label className="text-foreground">Email</Label>
                  <div className="relative">
                    <Mail className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type="email"
                      placeholder="you@example.com"
                      value={registerForm.email}
                      onChange={(e) => setRegisterForm({ ...registerForm, email: e.target.value })}
                      className="pl-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="register-email"
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <Label className="text-foreground">Password</Label>
                  <div className="relative">
                    <Lock className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type={showPassword ? "text" : "password"}
                      placeholder="••••••••"
                      value={registerForm.password}
                      onChange={(e) => setRegisterForm({ ...registerForm, password: e.target.value })}
                      className="pl-12 pr-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="register-password"
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
                    >
                      {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                    </button>
                  </div>
                </div>

                <div className="space-y-2">
                  <Label className="text-foreground">Confirm Password</Label>
                  <div className="relative">
                    <Lock className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                    <Input
                      type={showPassword ? "text" : "password"}
                      placeholder="••••••••"
                      value={registerForm.confirmPassword}
                      onChange={(e) => setRegisterForm({ ...registerForm, confirmPassword: e.target.value })}
                      className="pl-12 h-12 bg-card border-border rounded-xl text-foreground"
                      required
                      data-testid="register-confirm-password"
                    />
                  </div>
                </div>

                <Button
                  type="submit"
                  disabled={loading}
                  className="w-full h-12 bg-lime text-black font-bold rounded-xl hover:bg-lime/90"
                  data-testid="register-submit"
                >
                  {loading ? <Loader2 className="w-5 h-5 animate-spin" /> : "Create Account"}
                </Button>
              </form>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    );
  }

  // Logged in view
  return (
    <div className="min-h-screen bg-background pb-24" data-testid="profile-page-logged-in">
      {/* Header */}
      <div className="glass p-4 border-b border-border">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            {settings?.logo_url ? (
              <img src={settings.logo_url} alt="Logo" className="h-8" />
            ) : (
              <h1 className="font-heading text-xl text-lime tracking-tight">HYPD</h1>
            )}
            <span className="text-muted-foreground">Profile</span>
          </div>
          <div className="flex items-center gap-2">
            <ThemeToggle />
            <Button
              variant="ghost"
              size="icon"
              onClick={handleLogout}
              className="text-muted-foreground hover:text-foreground"
              data-testid="logout-button"
            >
              <LogOut className="w-5 h-5" />
            </Button>
          </div>
        </div>
      </div>

      <div className="p-6">
        {/* User Info */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-8"
        >
          <div className="w-24 h-24 rounded-full bg-gradient-to-br from-lime/20 to-violet/20 border-2 border-lime flex items-center justify-center mx-auto mb-4">
            <span className="font-heading text-3xl text-lime">
              {user.username?.charAt(0).toUpperCase()}
            </span>
          </div>
          <h2 className="font-heading text-2xl text-foreground mb-1">{user.username}</h2>
          <p className="text-muted-foreground text-sm">{user.email}</p>
        </motion.div>

        {/* Stats */}
        <div className="grid grid-cols-2 gap-4 mb-8">
          <div className="bg-card border border-border rounded-2xl p-4 text-center">
            <Heart className="w-6 h-6 text-red-500 mx-auto mb-2" />
            <p className="text-2xl font-heading text-foreground">{user.saved_games?.length || 0}</p>
            <p className="text-xs text-muted-foreground">Saved Games</p>
          </div>
          <div className="bg-card border border-border rounded-2xl p-4 text-center">
            <Trophy className="w-6 h-6 text-yellow-500 mx-auto mb-2" />
            <p className="text-2xl font-heading text-foreground">
              {Object.keys(user.high_scores || {}).length}
            </p>
            <p className="text-xs text-muted-foreground">High Scores</p>
          </div>
        </div>

        {/* Saved Games */}
        {savedGames.length > 0 && (
          <div className="mb-8">
            <h3 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
              <Heart className="w-5 h-5 text-red-500" />
              Saved Games
            </h3>
            <div className="space-y-3">
              {savedGames.map(game => (
                <motion.div
                  key={game.id}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  onClick={() => navigate(`/play/${game.id}`)}
                  className="flex items-center gap-4 bg-card border border-border rounded-xl p-3 cursor-pointer hover:border-lime/30 transition-colors"
                  data-testid={`saved-game-${game.id}`}
                >
                  <img
                    src={game.thumbnail_url || "https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=100&q=80"}
                    alt={game.title}
                    className="w-16 h-16 rounded-lg object-cover"
                  />
                  <div className="flex-1 min-w-0">
                    <h4 className="font-bold text-foreground truncate">{game.title}</h4>
                    <p className="text-xs text-muted-foreground">{game.category}</p>
                  </div>
                  <ChevronRight className="w-5 h-5 text-muted-foreground" />
                </motion.div>
              ))}
            </div>
          </div>
        )}

        {/* High Scores */}
        {Object.keys(user.high_scores || {}).length > 0 && (
          <div className="mb-8">
            <h3 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
              <Trophy className="w-5 h-5 text-yellow-500" />
              High Scores
            </h3>
            <div className="bg-card border border-border rounded-xl overflow-hidden">
              {Object.entries(user.high_scores).map(([gameId, score], index) => (
                <div
                  key={gameId}
                  className={`flex items-center justify-between p-4 ${
                    index !== Object.entries(user.high_scores).length - 1 
                      ? "border-b border-border" 
                      : ""
                  }`}
                >
                  <span className="text-foreground">Game #{gameId.slice(0, 8)}</span>
                  <span className="font-heading text-lime">{score.toLocaleString()}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Admin Link */}
        {user.is_admin && (
          <motion.button
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            onClick={() => navigate("/admin")}
            className="w-full flex items-center justify-between bg-violet/20 border border-violet/30 rounded-xl p-4 hover:bg-violet/30 transition-colors"
            data-testid="admin-link"
          >
            <div className="flex items-center gap-3">
              <Shield className="w-5 h-5 text-violet" />
              <span className="font-bold text-foreground">Admin Dashboard</span>
            </div>
            <ChevronRight className="w-5 h-5 text-muted-foreground" />
          </motion.button>
        )}

        {/* Hidden Admin Login Link */}
        <div className="mt-12 text-center">
          <button
            onClick={() => navigate("/admin")}
            className="text-xs text-muted-foreground/30 hover:text-muted-foreground transition-colors"
            data-testid="hidden-admin-link"
          >
            Admin Access
          </button>
        </div>
      </div>
    </div>
  );
}


--- /app/frontend/src/pages/AdminDashboard.jsx ---

import { useState, useEffect, useRef } from "react";
import { useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import {
  Shield, Plus, Trash2, Eye, EyeOff, Upload, Image, 
  Gamepad2, Loader2, ArrowLeft, Save, X, Database, BarChart3,
  FileUp, ImagePlus
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog";
import { useAuth } from "@/App";
import { toast } from "sonner";

const categories = ["Action", "Puzzle", "Arcade", "Racing", "Sports", "Strategy"];

export default function AdminDashboard() {
  const { user, token, API, setSettings } = useAuth();
  const navigate = useNavigate();
  const [games, setGames] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showAddDialog, setShowAddDialog] = useState(false);
  const [editingGame, setEditingGame] = useState(null);
  const [uploading, setUploading] = useState(false);
  
  // Form state
  const [formData, setFormData] = useState({
    title: "",
    description: "",
    category: "Action",
    is_visible: true
  });
  
  // File states
  const [gameFile, setGameFile] = useState(null);
  const [thumbnailFile, setThumbnailFile] = useState(null);
  const [exploreImageFile, setExploreImageFile] = useState(null);
  
  // Preview states
  const [thumbnailPreview, setThumbnailPreview] = useState(null);
  const [explorePreview, setExplorePreview] = useState(null);
  
  // Refs for file inputs
  const gameFileRef = useRef(null);
  const thumbnailRef = useRef(null);
  const exploreImageRef = useRef(null);

  useEffect(() => {
    if (!user?.is_admin) {
      toast.warning("Admin features require admin privileges");
    }
    fetchGames();
  }, [user]);

  const fetchGames = async () => {
    try {
      const res = await fetch(`${API}/admin/games`, {
        headers: token ? { Authorization: `Bearer ${token}` } : {}
      });
      if (res.ok) {
        const data = await res.json();
        setGames(data);
      } else if (res.status === 401 || res.status === 403) {
        const publicRes = await fetch(`${API}/games?visible_only=false`);
        if (publicRes.ok) {
          setGames(await publicRes.json());
        }
      }
    } catch (e) {
      console.error("Error fetching games:", e);
    }
    setLoading(false);
  };

  const handleFileChange = (e, type) => {
    const file = e.target.files?.[0];
    if (!file) return;
    
    if (type === 'game') {
      setGameFile(file);
    } else if (type === 'thumbnail') {
      setThumbnailFile(file);
      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => setThumbnailPreview(reader.result);
      reader.readAsDataURL(file);
    } else if (type === 'explore') {
      setExploreImageFile(file);
      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => setExplorePreview(reader.result);
      reader.readAsDataURL(file);
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!token) {
      toast.error("Please login as admin to manage games");
      return;
    }
    
    setUploading(true);
    try {
      const formDataToSend = new FormData();
      formDataToSend.append("title", formData.title);
      formDataToSend.append("description", formData.description);
      formDataToSend.append("category", formData.category);
      formDataToSend.append("is_visible", formData.is_visible);
      
      if (gameFile) {
        formDataToSend.append("game_file", gameFile);
      }
      if (thumbnailFile) {
        formDataToSend.append("thumbnail_file", thumbnailFile);
      }
      if (exploreImageFile) {
        formDataToSend.append("explore_image_file", exploreImageFile);
      }
      
      const url = editingGame 
        ? `${API}/admin/games/${editingGame.id}/update-with-files` 
        : `${API}/admin/games/create-with-files`;
      
      const res = await fetch(url, {
        method: editingGame ? "PUT" : "POST",
        headers: {
          Authorization: `Bearer ${token}`
        },
        body: formDataToSend
      });
      
      if (res.ok) {
        toast.success(editingGame ? "Game updated!" : "Game created!");
        setShowAddDialog(false);
        setEditingGame(null);
        resetForm();
        fetchGames();
      } else {
        const error = await res.json();
        toast.error(error.detail || "Failed to save game");
      }
    } catch (e) {
      console.error("Error saving game:", e);
      toast.error("Error saving game");
    }
    setUploading(false);
  };

  const handleDelete = async (gameId) => {
    if (!confirm("Are you sure you want to delete this game?")) return;
    if (!token) {
      toast.error("Please login as admin");
      return;
    }
    
    try {
      const res = await fetch(`${API}/admin/games/${gameId}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
      });
      
      if (res.ok) {
        toast.success("Game deleted");
        fetchGames();
      } else {
        toast.error("Failed to delete game");
      }
    } catch (e) {
      toast.error("Error deleting game");
    }
  };

  const handleToggleVisibility = async (game) => {
    if (!token) {
      toast.error("Please login as admin");
      return;
    }
    
    try {
      const res = await fetch(`${API}/admin/toggle-visibility/${game.id}`, {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` }
      });
      
      if (res.ok) {
        const data = await res.json();
        toast.success(data.message);
        fetchGames();
      }
    } catch (e) {
      toast.error("Error toggling visibility");
    }
  };

  const handleLogoUpload = async (e) => {
    const file = e.target.files?.[0];
    if (!file || !token) return;
    
    const formData = new FormData();
    formData.append("file", file);
    
    try {
      const res = await fetch(`${API}/admin/settings/logo`, {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` },
        body: formData
      });
      
      if (res.ok) {
        const data = await res.json();
        setSettings({ logo_url: data.logo_url });
        toast.success("Logo uploaded!");
      }
    } catch (e) {
      toast.error("Error uploading logo");
    }
  };

  const handleSeedGames = async () => {
    if (!token) {
      toast.error("Please login as admin");
      return;
    }
    
    setLoading(true);
    try {
      const res = await fetch(`${API}/admin/seed`, {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` }
      });
      
      if (res.ok) {
        toast.success("Sample games added!");
        fetchGames();
      } else {
        toast.error("Failed to seed games");
      }
    } catch (e) {
      toast.error("Error seeding games");
    }
    setLoading(false);
  };

  const handleGameFileUpload = async (gameId, e) => {
    const file = e.target.files?.[0];
    if (!file || !token) return;
    
    const formData = new FormData();
    formData.append("file", file);
    
    try {
      const res = await fetch(`${API}/admin/games/${gameId}/upload`, {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` },
        body: formData
      });
      
      if (res.ok) {
        toast.success("Game file uploaded!");
        fetchGames();
      } else {
        toast.error("Failed to upload game file");
      }
    } catch (e) {
      toast.error("Error uploading game file");
    }
  };

  const resetForm = () => {
    setFormData({
      title: "",
      description: "",
      category: "Action",
      is_visible: true
    });
    setGameFile(null);
    setThumbnailFile(null);
    setExploreImageFile(null);
    setThumbnailPreview(null);
    setExplorePreview(null);
    if (gameFileRef.current) gameFileRef.current.value = "";
    if (thumbnailRef.current) thumbnailRef.current.value = "";
    if (exploreImageRef.current) exploreImageRef.current.value = "";
  };

  const openEditDialog = (game) => {
    setEditingGame(game);
    setFormData({
      title: game.title,
      description: game.description,
      category: game.category,
      is_visible: game.is_visible
    });
    setThumbnailPreview(game.thumbnail_url);
    setExplorePreview(game.explore_image_url || game.thumbnail_url);
    setShowAddDialog(true);
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <Loader2 className="w-10 h-10 text-lime animate-spin" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background pb-24" data-testid="admin-dashboard">
      {/* Header */}
      <div className="glass p-4 border-b border-border sticky top-0 z-30">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <button
              onClick={() => navigate(-1)}
              className="w-10 h-10 rounded-full bg-card flex items-center justify-center"
              data-testid="admin-back-button"
            >
              <ArrowLeft className="w-5 h-5 text-foreground" />
            </button>
            <div className="flex items-center gap-2">
              <Shield className="w-5 h-5 text-violet" />
              <span className="font-heading text-lg text-foreground">Admin</span>
            </div>
          </div>
          
          <Dialog open={showAddDialog} onOpenChange={(open) => {
            setShowAddDialog(open);
            if (!open) {
              setEditingGame(null);
              resetForm();
            }
          }}>
            <DialogTrigger asChild>
              <Button 
                className="bg-lime text-black font-bold rounded-full"
                data-testid="add-game-button"
              >
                <Plus className="w-4 h-4 mr-2" />
                Add Game
              </Button>
            </DialogTrigger>
            <DialogContent className="bg-card border-border text-foreground max-w-lg max-h-[90vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle className="font-heading text-xl">
                  {editingGame ? "Edit Game" : "Add New Game"}
                </DialogTitle>
              </DialogHeader>
              
              <form onSubmit={handleSubmit} className="space-y-4 mt-4">
                {/* Title */}
                <div className="space-y-2">
                  <Label>Title *</Label>
                  <Input
                    value={formData.title}
                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                    placeholder="Game title"
                    className="bg-background border-border text-foreground"
                    required
                    data-testid="game-title-input"
                  />
                </div>

                {/* Description */}
                <div className="space-y-2">
                  <Label>Description *</Label>
                  <Textarea
                    value={formData.description}
                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                    placeholder="Game description"
                    className="bg-background border-border text-foreground min-h-[80px]"
                    required
                    data-testid="game-description-input"
                  />
                </div>

                {/* Category */}
                <div className="space-y-2">
                  <Label>Category *</Label>
                  <Select
                    value={formData.category}
                    onValueChange={(value) => setFormData({ ...formData, category: value })}
                  >
                    <SelectTrigger className="bg-background border-border text-foreground" data-testid="game-category-select">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent className="bg-card border-border">
                      {categories.map(cat => (
                        <SelectItem key={cat} value={cat} className="text-foreground hover:bg-white/10">
                          {cat}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>

                {/* Game File Upload */}
                <div className="space-y-2">
                  <Label className="flex items-center gap-2">
                    <FileUp className="w-4 h-4" />
                    Game File (.html, .zip)
                  </Label>
                  <div 
                    onClick={() => gameFileRef.current?.click()}
                    className="border-2 border-dashed border-white/20 rounded-xl p-4 text-center cursor-pointer hover:border-lime/50 transition-colors"
                  >
                    <input
                      ref={gameFileRef}
                      type="file"
                      accept=".html,.zip"
                      onChange={(e) => handleFileChange(e, 'game')}
                      className="hidden"
                      data-testid="game-file-input"
                    />
                    {gameFile ? (
                      <div className="flex items-center justify-center gap-2 text-lime">
                        <Gamepad2 className="w-5 h-5" />
                        <span className="text-sm font-medium">{gameFile.name}</span>
                        <button 
                          type="button"
                          onClick={(e) => {
                            e.stopPropagation();
                            setGameFile(null);
                            if (gameFileRef.current) gameFileRef.current.value = "";
                          }}
                          className="ml-2 text-red-400 hover:text-red-300"
                        >
                          <X className="w-4 h-4" />
                        </button>
                      </div>
                    ) : (
                      <div className="text-muted-foreground">
                        <Upload className="w-8 h-8 mx-auto mb-2" />
                        <p className="text-sm">Click to upload game file</p>
                        <p className="text-xs mt-1">Supports HTML5 games (.html) or ZIP archives</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Thumbnail Image Upload */}
                <div className="space-y-2">
                  <Label className="flex items-center gap-2">
                    <ImagePlus className="w-4 h-4" />
                    Feed Thumbnail Image
                  </Label>
                  <div 
                    onClick={() => thumbnailRef.current?.click()}
                    className="border-2 border-dashed border-white/20 rounded-xl p-4 text-center cursor-pointer hover:border-lime/50 transition-colors"
                  >
                    <input
                      ref={thumbnailRef}
                      type="file"
                      accept="image/*"
                      onChange={(e) => handleFileChange(e, 'thumbnail')}
                      className="hidden"
                      data-testid="thumbnail-file-input"
                    />
                    {thumbnailPreview ? (
                      <div className="relative">
                        <img 
                          src={thumbnailPreview} 
                          alt="Thumbnail preview" 
                          className="w-full h-32 object-cover rounded-lg"
                        />
                        <button 
                          type="button"
                          onClick={(e) => {
                            e.stopPropagation();
                            setThumbnailFile(null);
                            setThumbnailPreview(null);
                            if (thumbnailRef.current) thumbnailRef.current.value = "";
                          }}
                          className="absolute top-2 right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center"
                        >
                          <X className="w-4 h-4 text-foreground" />
                        </button>
                      </div>
                    ) : (
                      <div className="text-muted-foreground">
                        <Image className="w-8 h-8 mx-auto mb-2" />
                        <p className="text-sm">Click to upload feed thumbnail</p>
                        <p className="text-xs mt-1">Displayed in the main game feed</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Explore Image Upload */}
                <div className="space-y-2">
                  <Label className="flex items-center gap-2">
                    <ImagePlus className="w-4 h-4" />
                    Explore Tile Image (optional)
                  </Label>
                  <div 
                    onClick={() => exploreImageRef.current?.click()}
                    className="border-2 border-dashed border-white/20 rounded-xl p-4 text-center cursor-pointer hover:border-lime/50 transition-colors"
                  >
                    <input
                      ref={exploreImageRef}
                      type="file"
                      accept="image/*"
                      onChange={(e) => handleFileChange(e, 'explore')}
                      className="hidden"
                      data-testid="explore-image-input"
                    />
                    {explorePreview ? (
                      <div className="relative">
                        <img 
                          src={explorePreview} 
                          alt="Explore preview" 
                          className="w-full h-32 object-cover rounded-lg"
                        />
                        <button 
                          type="button"
                          onClick={(e) => {
                            e.stopPropagation();
                            setExploreImageFile(null);
                            setExplorePreview(null);
                            if (exploreImageRef.current) exploreImageRef.current.value = "";
                          }}
                          className="absolute top-2 right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center"
                        >
                          <X className="w-4 h-4 text-foreground" />
                        </button>
                      </div>
                    ) : (
                      <div className="text-muted-foreground">
                        <Image className="w-8 h-8 mx-auto mb-2" />
                        <p className="text-sm">Click to upload explore tile image</p>
                        <p className="text-xs mt-1">Uses thumbnail if not provided</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* Visibility Toggle */}
                <div className="flex items-center justify-between py-2">
                  <Label>Visible in Feed</Label>
                  <Switch
                    checked={formData.is_visible}
                    onCheckedChange={(checked) => setFormData({ ...formData, is_visible: checked })}
                    data-testid="game-visibility-switch"
                  />
                </div>

                {/* Submit Buttons */}
                <div className="flex gap-3 pt-4">
                  <Button
                    type="button"
                    variant="outline"
                    onClick={() => {
                      setShowAddDialog(false);
                      setEditingGame(null);
                      resetForm();
                    }}
                    className="flex-1 border-border text-foreground hover:bg-white/10"
                  >
                    Cancel
                  </Button>
                  <Button
                    type="submit"
                    disabled={uploading}
                    className="flex-1 bg-lime text-black font-bold hover:bg-lime/90"
                    data-testid="save-game-button"
                  >
                    {uploading ? (
                      <Loader2 className="w-4 h-4 animate-spin" />
                    ) : (
                      <>
                        <Save className="w-4 h-4 mr-2" />
                        {editingGame ? "Update" : "Create"} Game
                      </>
                    )}
                  </Button>
                </div>
              </form>
            </DialogContent>
          </Dialog>
        </div>
      </div>

      <div className="p-4 space-y-6">
        {/* Quick Actions */}
        <div className="grid grid-cols-3 gap-4">
          <label className="cursor-pointer">
            <input
              type="file"
              accept="image/*"
              onChange={handleLogoUpload}
              className="hidden"
            />
            <div className="bg-card border border-border rounded-xl p-4 text-center hover:border-lime/30 transition-colors h-full">
              <Image className="w-8 h-8 text-lime mx-auto mb-2" />
              <p className="text-sm font-medium text-foreground">Upload Logo</p>
            </div>
          </label>
          
          <button
            onClick={handleSeedGames}
            className="bg-card border border-border rounded-xl p-4 text-center hover:border-lime/30 transition-colors"
            data-testid="seed-games-button"
          >
            <Database className="w-8 h-8 text-violet mx-auto mb-2" />
            <p className="text-sm font-medium text-foreground">Seed Games</p>
          </button>

          <button
            onClick={() => navigate("/admin/analytics")}
            className="bg-card border border-lime/30 rounded-xl p-4 text-center hover:border-lime/50 transition-colors"
            data-testid="analytics-button"
          >
            <BarChart3 className="w-8 h-8 text-lime mx-auto mb-2" />
            <p className="text-sm font-medium text-foreground">Analytics</p>
          </button>
        </div>

        {/* Games List */}
        <div>
          <h2 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
            <Gamepad2 className="w-5 h-5 text-lime" />
            Games ({games.length})
          </h2>

          {games.length === 0 ? (
            <div className="text-center py-12 bg-card border border-border rounded-xl">
              <Gamepad2 className="w-12 h-12 text-muted-foreground mx-auto mb-4" />
              <p className="text-muted-foreground mb-4">No games yet</p>
              <Button
                onClick={() => setShowAddDialog(true)}
                className="bg-lime text-black font-bold rounded-full"
              >
                <Plus className="w-4 h-4 mr-2" />
                Add Your First Game
              </Button>
            </div>
          ) : (
            <div className="space-y-3">
              {games.map((game, index) => (
                <motion.div
                  key={game.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.05 }}
                  className="bg-card border border-border rounded-xl p-4"
                  data-testid={`admin-game-${index}`}
                >
                  <div className="flex gap-4">
                    {/* Thumbnail */}
                    <div className="w-20 h-20 rounded-lg overflow-hidden bg-muted flex-shrink-0">
                      <img
                        src={game.thumbnail_url || "https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=100&q=80"}
                        alt={game.title}
                        className="w-full h-full object-cover"
                      />
                    </div>

                    {/* Info */}
                    <div className="flex-1 min-w-0">
                      <div className="flex items-start justify-between gap-2">
                        <div>
                          <h3 className="font-bold text-foreground truncate">{game.title}</h3>
                          <p className="text-xs text-muted-foreground">{game.category}</p>
                        </div>
                        <div className={`px-2 py-1 rounded-full text-xs font-medium ${
                          game.is_visible 
                            ? "bg-lime/20 text-lime" 
                            : "bg-red-500/20 text-red-400"
                        }`}>
                          {game.is_visible ? "Visible" : "Hidden"}
                        </div>
                      </div>
                      
                      <p className="text-sm text-muted-foreground mt-1 line-clamp-1">
                        {game.description}
                      </p>
                      
                      <div className="flex items-center gap-2 mt-2 text-xs text-muted-foreground">
                        <span>{game.play_count || 0} plays</span>
                        <span>•</span>
                        <span className={game.has_game_file ? "text-lime" : "text-orange-400"}>
                          {game.has_game_file ? "✓ Has game file" : "⚠ No game file"}
                        </span>
                      </div>
                    </div>
                  </div>

                  {/* Actions */}
                  <div className="flex items-center gap-2 mt-4 pt-4 border-t border-border">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => openEditDialog(game)}
                      className="flex-1 border-border text-foreground hover:bg-white/10"
                      data-testid={`edit-game-${index}`}
                    >
                      Edit
                    </Button>
                    
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => handleToggleVisibility(game)}
                      className="border-border text-foreground hover:bg-white/10"
                      data-testid={`toggle-visibility-${index}`}
                    >
                      {game.is_visible ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                    </Button>

                    <label className="cursor-pointer">
                      <input
                        type="file"
                        accept=".html,.zip"
                        onChange={(e) => handleGameFileUpload(game.id, e)}
                        className="hidden"
                      />
                      <div className="h-9 px-3 flex items-center justify-center border border-border rounded-md text-foreground hover:bg-white/10 transition-colors">
                        <Upload className="w-4 h-4" />
                      </div>
                    </label>
                    
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => handleDelete(game.id)}
                      className="border-red-500/30 text-red-400 hover:bg-red-500/10"
                      data-testid={`delete-game-${index}`}
                    >
                      <Trash2 className="w-4 h-4" />
                    </Button>
                  </div>
                </motion.div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}


--- /app/frontend/src/pages/AnalyticsDashboard.jsx ---

import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import {
  ArrowLeft, TrendingUp, Users, Gamepad2, Clock, Play,
  BarChart3, PieChart, Activity, Loader2, ChevronRight
} from "lucide-react";
import { useAuth } from "@/App";
import {
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
  PieChart as RechartsPie, Pie, Cell, LineChart, Line, Area, AreaChart
} from "recharts";

const COLORS = ["#CCFF00", "#7000FF", "#FF4444", "#00FFFF", "#FF7F00", "#44FF44"];

export default function AnalyticsDashboard() {
  const { API, token, user } = useAuth();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [analytics, setAnalytics] = useState(null);
  const [selectedGame, setSelectedGame] = useState(null);
  const [gameAnalytics, setGameAnalytics] = useState(null);

  useEffect(() => {
    fetchAnalytics();
  }, []);

  const fetchAnalytics = async () => {
    if (!token) return;
    try {
      const res = await fetch(`${API}/admin/analytics/overview`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (res.ok) {
        const data = await res.json();
        setAnalytics(data);
      }
    } catch (e) {
      console.error("Error fetching analytics:", e);
    }
    setLoading(false);
  };

  const fetchGameAnalytics = async (gameId) => {
    if (!token) return;
    try {
      const res = await fetch(`${API}/admin/analytics/game/${gameId}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (res.ok) {
        const data = await res.json();
        setGameAnalytics(data);
        setSelectedGame(gameId);
      }
    } catch (e) {
      console.error("Error fetching game analytics:", e);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background">
        <Loader2 className="w-10 h-10 text-lime animate-spin" />
      </div>
    );
  }

  if (!analytics) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-background p-8">
        <BarChart3 className="w-16 h-16 text-muted-foreground mb-4" />
        <p className="text-muted-foreground">No analytics data available</p>
        <button
          onClick={() => navigate("/admin")}
          className="mt-4 px-6 py-2 bg-lime text-black rounded-full font-bold"
        >
          Back to Admin
        </button>
      </div>
    );
  }

  // Prepare pie chart data
  const categoryData = Object.entries(analytics.plays_by_category || {}).map(([name, value]) => ({
    name,
    value
  }));

  return (
    <div className="min-h-screen bg-background pb-24" data-testid="analytics-dashboard">
      {/* Header */}
      <div className="glass p-4 border-b border-border sticky top-0 z-30">
        <div className="flex items-center gap-4">
          <button
            onClick={() => navigate("/admin")}
            className="w-10 h-10 rounded-full bg-card flex items-center justify-center"
            data-testid="analytics-back-button"
          >
            <ArrowLeft className="w-5 h-5 text-foreground" />
          </button>
          <div className="flex items-center gap-2">
            <BarChart3 className="w-5 h-5 text-lime" />
            <span className="font-heading text-lg text-foreground">Analytics</span>
          </div>
        </div>
      </div>

      <div className="p-4 space-y-6">
        {/* Overview Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="bg-card border border-border rounded-xl p-4"
          >
            <div className="flex items-center gap-3 mb-2">
              <div className="w-10 h-10 rounded-lg bg-lime/20 flex items-center justify-center">
                <Play className="w-5 h-5 text-lime" />
              </div>
            </div>
            <p className="text-2xl font-heading text-foreground">{analytics.total_plays.toLocaleString()}</p>
            <p className="text-xs text-muted-foreground">Total Plays</p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="bg-card border border-border rounded-xl p-4"
          >
            <div className="flex items-center gap-3 mb-2">
              <div className="w-10 h-10 rounded-lg bg-violet/20 flex items-center justify-center">
                <Users className="w-5 h-5 text-violet" />
              </div>
            </div>
            <p className="text-2xl font-heading text-foreground">{analytics.total_users}</p>
            <p className="text-xs text-muted-foreground">Total Users</p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="bg-card border border-border rounded-xl p-4"
          >
            <div className="flex items-center gap-3 mb-2">
              <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                <Gamepad2 className="w-5 h-5 text-cyan-500" />
              </div>
            </div>
            <p className="text-2xl font-heading text-foreground">{analytics.total_games}</p>
            <p className="text-xs text-muted-foreground">Total Games</p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="bg-card border border-border rounded-xl p-4"
          >
            <div className="flex items-center gap-3 mb-2">
              <div className="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center">
                <Activity className="w-5 h-5 text-orange-500" />
              </div>
            </div>
            <p className="text-2xl font-heading text-foreground">{analytics.plays_today}</p>
            <p className="text-xs text-muted-foreground">Plays Today</p>
          </motion.div>
        </div>

        {/* Weekly Plays Chart */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.4 }}
          className="bg-card border border-border rounded-xl p-4"
        >
          <h3 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5 text-lime" />
            Plays This Week
          </h3>
          <div className="h-64">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={analytics.plays_by_day}>
                <defs>
                  <linearGradient id="colorPlays" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#CCFF00" stopOpacity={0.3}/>
                    <stop offset="95%" stopColor="#CCFF00" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" stroke="#27272A" />
                <XAxis dataKey="day" stroke="#71717A" fontSize={12} />
                <YAxis stroke="#71717A" fontSize={12} />
                <Tooltip 
                  contentStyle={{ 
                    backgroundColor: "#121212", 
                    border: "1px solid #27272A",
                    borderRadius: "8px",
                    color: "#fff"
                  }}
                />
                <Area 
                  type="monotone" 
                  dataKey="plays" 
                  stroke="#CCFF00" 
                  strokeWidth={2}
                  fillOpacity={1} 
                  fill="url(#colorPlays)" 
                />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </motion.div>

        {/* Category Distribution */}
        {categoryData.length > 0 && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.5 }}
            className="bg-card border border-border rounded-xl p-4"
          >
            <h3 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
              <PieChart className="w-5 h-5 text-violet" />
              Plays by Category
            </h3>
            <div className="h-64 flex items-center justify-center">
              <ResponsiveContainer width="100%" height="100%">
                <RechartsPie>
                  <Pie
                    data={categoryData}
                    cx="50%"
                    cy="50%"
                    innerRadius={60}
                    outerRadius={100}
                    paddingAngle={2}
                    dataKey="value"
                    label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                    labelLine={false}
                  >
                    {categoryData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip 
                    contentStyle={{ 
                      backgroundColor: "#121212", 
                      border: "1px solid #27272A",
                      borderRadius: "8px",
                      color: "#fff"
                    }}
                  />
                </RechartsPie>
              </ResponsiveContainer>
            </div>
            <div className="flex flex-wrap gap-3 mt-4 justify-center">
              {categoryData.map((entry, index) => (
                <div key={entry.name} className="flex items-center gap-2">
                  <div 
                    className="w-3 h-3 rounded-full" 
                    style={{ backgroundColor: COLORS[index % COLORS.length] }}
                  />
                  <span className="text-sm text-muted-foreground">{entry.name}</span>
                </div>
              ))}
            </div>
          </motion.div>
        )}

        {/* Top Games */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
          className="bg-card border border-border rounded-xl p-4"
        >
          <h3 className="text-lg font-bold text-foreground mb-4 flex items-center gap-2">
            <Gamepad2 className="w-5 h-5 text-lime" />
            Top Games
          </h3>
          <div className="space-y-3">
            {analytics.top_games.map((game, index) => (
              <div
                key={game.game_id}
                onClick={() => fetchGameAnalytics(game.game_id)}
                className="flex items-center gap-4 p-3 bg-background/50 rounded-xl cursor-pointer hover:bg-background transition-colors"
                data-testid={`top-game-${index}`}
              >
                <div className="w-8 h-8 rounded-lg bg-lime/20 flex items-center justify-center font-heading text-lime">
                  {index + 1}
                </div>
                <img
                  src={game.thumbnail_url || "https://images.unsplash.com/photo-1637734373619-af1e76434bec?w=100&q=80"}
                  alt={game.title}
                  className="w-12 h-12 rounded-lg object-cover"
                />
                <div className="flex-1 min-w-0">
                  <h4 className="font-bold text-foreground truncate">{game.title}</h4>
                  <p className="text-xs text-muted-foreground">{game.category}</p>
                </div>
                <div className="text-right">
                  <p className="font-heading text-lime">{game.plays.toLocaleString()}</p>
                  <p className="text-xs text-muted-foreground">plays</p>
                </div>
                <ChevronRight className="w-5 h-5 text-muted-foreground" />
              </div>
            ))}
          </div>
        </motion.div>

        {/* Game Detail Modal */}
        {selectedGame && gameAnalytics && (
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80"
            onClick={() => setSelectedGame(null)}
          >
            <div 
              className="bg-card border border-border rounded-2xl p-6 max-w-lg w-full max-h-[80vh] overflow-y-auto"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="flex items-center justify-between mb-6">
                <h3 className="font-heading text-xl text-foreground">{gameAnalytics.title}</h3>
                <button
                  onClick={() => setSelectedGame(null)}
                  className="text-muted-foreground hover:text-foreground"
                >
                  ✕
                </button>
              </div>

              <div className="grid grid-cols-2 gap-4 mb-6">
                <div className="bg-background/50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-heading text-lime">{gameAnalytics.total_plays}</p>
                  <p className="text-xs text-muted-foreground">Total Plays</p>
                </div>
                <div className="bg-background/50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-heading text-violet">{gameAnalytics.unique_players}</p>
                  <p className="text-xs text-muted-foreground">Unique Players</p>
                </div>
                <div className="bg-background/50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-heading text-cyan-500">{gameAnalytics.plays_today}</p>
                  <p className="text-xs text-muted-foreground">Plays Today</p>
                </div>
                <div className="bg-background/50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-heading text-orange-500">{gameAnalytics.plays_this_week}</p>
                  <p className="text-xs text-muted-foreground">This Week</p>
                </div>
              </div>

              {/* Daily Chart */}
              <h4 className="text-sm font-bold text-foreground mb-3">Daily Plays</h4>
              <div className="h-40 mb-4">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart data={gameAnalytics.daily_plays}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#27272A" />
                    <XAxis dataKey="day" stroke="#71717A" fontSize={10} />
                    <YAxis stroke="#71717A" fontSize={10} />
                    <Tooltip 
                      contentStyle={{ 
                        backgroundColor: "#121212", 
                        border: "1px solid #27272A",
                        borderRadius: "8px",
                        color: "#fff"
                      }}
                    />
                    <Bar dataKey="plays" fill="#CCFF00" radius={[4, 4, 0, 0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>

              {/* Stats */}
              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-muted-foreground">Avg. Play Duration</span>
                  <span className="text-foreground">{Math.round(gameAnalytics.avg_duration_seconds)}s</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-muted-foreground">Total Play Time</span>
                  <span className="text-foreground">{gameAnalytics.total_play_time_minutes} min</span>
                </div>
                {gameAnalytics.score_stats?.high_score > 0 && (
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">High Score</span>
                    <span className="text-lime">{gameAnalytics.score_stats.high_score.toLocaleString()}</span>
                  </div>
                )}
              </div>
            </div>
          </motion.div>
        )}
      </div>
    </div>
  );
}


========== DOCUMENTATION ==========


--- /app/memory/PRD.md ---

# Hypd Games - Product Requirements Document

## Project Overview
**Name:** Hypd Games  
**Type:** Mobile-first instant gaming website  
**Core Concept:** TikTok-style vertical endless scroll feed for HTML5 browser games  

## Original Problem Statement
Build a mobile-first instant gaming website featuring a vertical, "TikTok-style" endless scroll feed where users swipe through game previews and tap to play instantly. Features include Game Feed, Game Player (fullscreen with draggable back button), Navigation tabs (Feed, Explore, PRO, Profile), and Admin Dashboard for game management.

## User Choices
- **Authentication:** JWT-based custom auth (email/password)
- **Storage:** Mock storage with MongoDB (no external cloud storage)
- **PRO Membership:** Placeholder page for now
- **Sample Games:** Included 4 HTML5 games for demo
- **Design:** Dark gaming aesthetic with lime (#CCFF00) accent color

## User Personas
1. **Casual Mobile Gamers** - Looking for instant browser games during commute/breaks
2. **Game Publishers** - Want to publish and manage HTML5 games
3. **Platform Admins** - Need to curate and manage game catalog

## Core Requirements (Static)
1. Mobile-first responsive design
2. TikTok-style vertical snap scrolling
3. Instant game loading (no downloads)
4. User authentication with progress saving
5. Admin game management dashboard

## What's Been Implemented (January 17, 2026)

### Backend (FastAPI + MongoDB)
- ✅ JWT Authentication (register, login, profile)
- ✅ Game CRUD operations
- ✅ Game file storage with GridFS (mock)
- ✅ User saved games & high scores
- ✅ Admin game management endpoints
- ✅ Settings endpoint for logo customization
- ✅ Sample game seeding endpoint
- ✅ 4 embedded HTML5 games (Neon Blocks, Space Dodge, Color Match, Cyber Runner)
- ✅ **Analytics System** - Play session tracking, overview stats, per-game analytics

### Frontend (React)
- ✅ Game Feed - TikTok-style vertical snap scroll
- ✅ Game Player - Fullscreen iframe with draggable back button + session tracking
- ✅ Explore Page - Category tiles, search, grid view
- ✅ PRO Page - Membership placeholder with pricing plans
- ✅ Profile Page - Login/Register, saved games, high scores
- ✅ Admin Dashboard - Game management, logo upload, seed games
- ✅ **Analytics Dashboard** - Charts for plays, categories, top games, detailed game stats
- ✅ Bottom Navigation - Glass effect, 4 tabs

### Design System
- Dark theme (#050505 background)
- Lime accent (#CCFF00)
- Chivo (headings) + Manrope (body) fonts
- Glassmorphism effects
- Framer Motion animations

## Test Credentials
- **Admin:** admin@hypd.games / admin123

## P0 Features (Completed)
- [x] Game Feed with snap scrolling
- [x] Game Player with fullscreen
- [x] User authentication
- [x] Admin game management
- [x] Bottom navigation

## P1 Features (Next Phase)
- [ ] Video previews for games
- [ ] Social sharing integration
- [ ] User leaderboards
- [ ] Game progress auto-save

## P2 Features (Future)
- [ ] Stripe integration for PRO membership
- [ ] Cloud storage (S3) for game files
- [ ] Push notifications
- [ ] Game recommendations based on play history

## Next Action Items
1. Integrate actual payment processing for PRO tier
2. Add real cloud storage for game file uploads
3. Implement game analytics and play tracking
4. Add social features (friends, challenges)
5. SEO optimization for game discovery


========== PROJECT STRUCTURE ==========


/app/
├── backend/
│   ├── server.py              # FastAPI backend with all routes
│   ├── requirements.txt       # Python dependencies
│   └── .env                   # Environment variables
├── frontend/
│   ├── package.json           # Node dependencies
│   ├── tailwind.config.js     # Tailwind configuration
│   ├── .env                   # Frontend env (REACT_APP_BACKEND_URL)
│   └── src/
│       ├── index.js           # React entry point
│       ├── index.css          # Global styles + theme variables
│       ├── App.js             # Main app with routing
│       ├── App.css            # Component styles
│       ├── contexts/
│       │   └── ThemeContext.jsx    # Theme provider
│       ├── components/
│       │   ├── BottomNav.jsx       # Bottom navigation
│       │   ├── ThemeToggle.jsx     # Theme toggle button
│       │   └── ui/                 # Shadcn UI components
│       └── pages/
│           ├── GameFeed.jsx        # TikTok-style game feed
│           ├── GamePlayer.jsx      # Fullscreen game player
│           ├── Explore.jsx         # Game catalog
│           ├── Pro.jsx             # PRO membership page
│           ├── Profile.jsx         # User profile/auth
│           ├── AdminDashboard.jsx  # Admin game management
│           └── AnalyticsDashboard.jsx  # Analytics
└── memory/
    └── PRD.md                 # Product requirements



========== SETUP INSTRUCTIONS ==========


1. Backend Setup:
   cd backend
   pip install -r requirements.txt
   # Configure .env with MongoDB URL
   uvicorn server:app --host 0.0.0.0 --port 8001 --reload

2. Frontend Setup:
   cd frontend
   yarn install
   # Configure .env with backend URL
   yarn start

3. Default Admin Credentials:
   Email: admin@hypd.games
   Password: admin123
   (Create via register, then set is_admin=true in MongoDB)

4. Seed Sample Games:
   Login as admin → Admin Dashboard → Click 'Seed Games'

5. Features:
   - TikTok-style vertical game feed
   - HTML5 game player (supports .html and .zip files)
   - User auth with JWT
   - Game save/favorite functionality
   - Admin dashboard with analytics
   - Light/Dark theme toggle

